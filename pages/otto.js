// Auto-generated JavaScript for Otto page
// This file injects HTML content into the DOM when loaded

(function() {
    'use strict';
    
    // HTML content as string
    const HTML_CONTENT = "\\n<!DOCTYPE html>\\n<html>\\n<head>\\n    <meta charset=\"UTF-8\">\\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\\n    <title>Otto Robot Control</title>\\n    <!-- Load CSS from external -->\\n    <link rel=\"stylesheet\" href=\"https://nguenvanky.github.io/App/styles/otto.min.css?v=1.0.0\" \\n          onerror=\"loadFallbackCSS(\'otto\')\">\\n    <!-- Fallback CSS (minimal inline for offline mode) -->\\n    <noscript>\\n        <style>\\n        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }\\n        body {\\n            font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, \'Helvetica Neue\', Arial, sans-serif;\\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\\n            min-height: 100vh;\\n            padding: 10px;\\n            padding-bottom: env(safe-area-inset-bottom);\\n            -webkit-font-smoothing: antialiased;\\n            -moz-osx-font-smoothing: grayscale;\\n        }\\n        .container {\\n            max-width: 1200px;\\n            margin: 0 auto;\\n            background: white;\\n            border-radius: 16px;\\n            padding: 15px;\\n            box-shadow: 0 10px 40px rgba(0,0,0,0.2);\\n        }\\n        h1 {\\n            color: #667eea;\\n            text-align: center;\\n            margin-bottom: 15px;\\n            font-size: 24px;\\n        }\\n        .status {\\n            text-align: center;\\n            padding: 12px;\\n            margin-bottom: 15px;\\n            border-radius: 8px;\\n            font-weight: bold;\\n            font-size: 16px;\\n        }\\n        .status.idle { background: #d4edda; color: #155724; }\\n        .status.moving { background: #fff3cd; color: #856404; }\\n        .control-section {\\n            margin-bottom: 20px;\\n        }\\n        .portal-music-box {\\n            border: 1px dashed #cbd5f5;\\n            background: #f8f9ff;\\n            padding: 12px;\\n            border-radius: 10px;\\n            margin-bottom: 12px;\\n        }\\n        .portal-music-status {\\n            font-size: 13px;\\n            color: #4c51bf;\\n        }\\n        .portal-music-status.error {\\n            color: #c53030;\\n        }\\n        .portal-music-list {\\n            margin-top: 12px;\\n            display: flex;\\n            flex-direction: column;\\n            gap: 8px;\\n        }\\n        .portal-music-item {\\n            display: flex;\\n            justify-content: space-between;\\n            align-items: center;\\n            padding: 10px;\\n            border-radius: 8px;\\n            background: white;\\n            border: 1px solid #e2e8f0;\\n            box-shadow: 0 1px 2px rgba(0,0,0,0.05);\\n        }\\n        .portal-music-meta {\\n            display: flex;\\n            flex-direction: column;\\n            gap: 4px;\\n            font-size: 13px;\\n        }\\n        .portal-music-meta strong {\\n            color: #2d3748;\\n        }\\n        .portal-music-select {\\n            background: #667eea;\\n            color: white;\\n            border: none;\\n            border-radius: 6px;\\n            padding: 8px 14px;\\n            font-size: 13px;\\n            cursor: pointer;\\n            transition: transform 0.2s, box-shadow 0.2s;\\n        }\\n        .portal-music-select:hover {\\n            transform: translateY(-1px);\\n            box-shadow: 0 4px 8px rgba(102,126,234,0.3);\\n        }\\n        .portal-music-select:active {\\n            transform: translateY(0);\\n            box-shadow: none;\\n        }\\n        .portal-radio-box {\\n            border: 1px dashed #cbd5f5;\\n            background: #f8f9ff;\\n            padding: 12px;\\n            border-radius: 10px;\\n            margin-bottom: 12px;\\n        }\\n        .portal-radio-status {\\n            font-size: 13px;\\n            color: #4c51bf;\\n        }\\n        .portal-radio-status.error {\\n            color: #c53030;\\n        }\\n        .portal-radio-list {\\n            margin-top: 12px;\\n            display: flex;\\n            flex-direction: column;\\n            gap: 8px;\\n        }\\n        .portal-radio-item {\\n            display: flex;\\n            justify-content: space-between;\\n            align-items: center;\\n            padding: 10px;\\n            border-radius: 8px;\\n            background: white;\\n            border: 1px solid #e2e8f0;\\n            box-shadow: 0 1px 2px rgba(0,0,0,0.05);\\n        }\\n        .portal-radio-meta {\\n            display: flex;\\n            flex-direction: column;\\n            gap: 4px;\\n            font-size: 13px;\\n        }\\n        .portal-radio-meta strong {\\n            color: #2d3748;\\n        }\\n        .portal-radio-select {\\n            background: #667eea;\\n            color: white;\\n            border: none;\\n            border-radius: 6px;\\n            padding: 8px 14px;\\n            font-size: 13px;\\n            cursor: pointer;\\n            transition: transform 0.2s, box-shadow 0.2s;\\n        }\\n        .portal-radio-select:hover {\\n            transform: translateY(-1px);\\n            box-shadow: 0 4px 8px rgba(102,126,234,0.3);\\n        }\\n        .portal-radio-select:active {\\n            transform: translateY(0);\\n            box-shadow: none;\\n        }\\n        .section-title {\\n            color: #667eea;\\n            font-size: 18px;\\n            margin-bottom: 12px;\\n            padding-bottom: 8px;\\n            border-bottom: 2px solid #667eea;\\n        }\\n        .volume-section {\\n            background: linear-gradient(135deg, #fff7ed 0%, #ffedd5 100%);\\n            border-left: 4px solid #fb923c;\\n            padding: 15px;\\n            border-radius: 12px;\\n        }\\n        .volume-slider {\\n            display: flex;\\n            flex-direction: column;\\n            gap: 10px;\\n        }\\n        .volume-slider input[type=\"range\"] {\\n            width: 100%;\\n            accent-color: #fb923c;\\n            height: 6px;\\n        }\\n        .volume-value {\\n            text-align: center;\\n            font-weight: bold;\\n            font-size: 18px;\\n            color: #c2410c;\\n        }\\n        .control-grid {\\n            display: grid;\\n            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));\\n            gap: 10px;\\n            margin-bottom: 15px;\\n        }\\n        .btn {\\n            padding: 18px 16px;\\n            border: none;\\n            border-radius: 12px;\\n            font-size: 15px;\\n            font-weight: bold;\\n            cursor: pointer;\\n            transition: all 0.2s;\\n            background: #667eea;\\n            color: white;\\n            touch-action: manipulation;\\n            user-select: none;\\n            -webkit-user-select: none;\\n            min-height: 50px;\\n            box-shadow: 0 2px 8px rgba(0,0,0,0.15);\\n        }\\n        .btn:active { \\n            transform: scale(0.95); \\n            box-shadow: 0 1px 4px rgba(0,0,0,0.2);\\n        }\\n        .btn.stop { background: #dc3545; }\\n        .btn.stop:active { background: #c82333; }\\n        .btn-direction {\\n            grid-column: span 1;\\n            padding: 25px 15px;\\n            font-size: 20px;\\n            min-height: 70px;\\n            font-weight: 600;\\n        }\\n        .direction-grid {\\n            display: grid;\\n            grid-template-columns: repeat(3, 1fr);\\n            gap: 12px;\\n            max-width: 100%;\\n            margin: 0 auto;\\n            padding: 10px;\\n        }\\n        .direction-grid .btn:nth-child(2) { grid-column: 2; } /* Up */\\n        .direction-grid .btn:nth-child(4) { grid-column: 1; } /* Left */\\n        .direction-grid .btn:nth-child(5) { grid-column: 2; } /* Stop */\\n        .direction-grid .btn:nth-child(6) { grid-column: 3; } /* Right */\\n        .direction-grid .btn:nth-child(8) { grid-column: 2; } /* Down */\\n        .emoji-grid {\\n            display: grid;\\n            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));\\n            gap: 10px;\\n        }\\n        .emoji-btn {\\n            padding: 15px;\\n            font-size: 28px;\\n            background: #f8f9fa;\\n            color: #333;\\n            min-height: 70px;\\n        }\\n        .emoji-btn:active { \\n            background: #e9ecef; \\n            transform: scale(0.95);\\n        }\\n        .lang-selector {\\n            position: fixed;\\n            top: 10px;\\n            right: 10px;\\n            background: rgba(255, 255, 255, 0.95);\\n            padding: 8px 12px;\\n            border-radius: 8px;\\n            box-shadow: 0 4px 12px rgba(0,0,0,0.15);\\n            z-index: 1000;\\n            backdrop-filter: blur(10px);\\n        }\\n        .pwa-install-fixed {\\n            position: fixed;\\n            bottom: 10px;\\n            right: 10px;\\n            background: rgba(255, 255, 255, 0.95);\\n            padding: 12px 16px;\\n            border-radius: 8px;\\n            box-shadow: 0 4px 12px rgba(0,0,0,0.15);\\n            z-index: 1000;\\n            backdrop-filter: blur(10px);\\n            text-align: center;\\n        }\\n        .pwa-install-fixed button {\\n            font-size: 12px;\\n            padding: 10px 16px;\\n            white-space: nowrap;\\n        }\\n        .pwa-install-fixed > div {\\n            font-size: 10px;\\n            color: #666;\\n            margin-top: 4px;\\n        }\\n        .menu-button {\\n            position: fixed;\\n            top: 10px;\\n            left: 10px;\\n            background: rgba(102, 126, 234, 0.95);\\n            color: white;\\n            border: none;\\n            border-radius: 50%;\\n            width: 50px;\\n            height: 50px;\\n            font-size: 24px;\\n            cursor: pointer;\\n            z-index: 1001;\\n            box-shadow: 0 4px 12px rgba(0,0,0,0.2);\\n            transition: all 0.3s;\\n            display: flex;\\n            align-items: center;\\n            justify-content: center;\\n            touch-action: manipulation;\\n        }\\n        .menu-button:active {\\n            transform: scale(0.9);\\n            background: rgba(118, 75, 162, 0.95);\\n        }\\n        .menu-button.menu-ai {\\n            top: 70px;\\n            background: rgba(16, 185, 129, 0.95);\\n        }\\n        .menu-button.menu-ai:active {\\n            background: rgba(5, 150, 105, 0.95);\\n        }\\n        .menu-panel {\\n            position: fixed;\\n            top: 70px;\\n            left: 10px;\\n            background: white;\\n            border-radius: 12px;\\n            box-shadow: 0 8px 24px rgba(0,0,0,0.3);\\n            padding: 15px;\\n            min-width: 200px;\\n            z-index: 1000;\\n            display: none;\\n            backdrop-filter: blur(10px);\\n        }\\n        .menu-panel.show {\\n            display: block;\\n            animation: slideDown 0.3s ease-out;\\n        }\\n        @keyframes slideDown {\\n            from {\\n                opacity: 0;\\n                transform: translateY(-10px);\\n            }\\n            to {\\n                opacity: 1;\\n                transform: translateY(0);\\n            }\\n        }\\n        .menu-item {\\n            display: block;\\n            padding: 12px 15px;\\n            margin: 5px 0;\\n            background: #f5f7fa;\\n            border-radius: 8px;\\n            text-decoration: none;\\n            color: #333;\\n            font-size: 14px;\\n            font-weight: 500;\\n            transition: all 0.2s;\\n            cursor: pointer;\\n        }\\n        .menu-item:active {\\n            background: #667eea;\\n            color: white;\\n            transform: scale(0.98);\\n        }\\n        .menu-item:hover {\\n            background: #e9ecef;\\n        }\\n        .lang-selector select {\\n            padding: 6px 10px;\\n            border: 2px solid #667eea;\\n            border-radius: 6px;\\n            font-size: 13px;\\n            background: white;\\n            color: #333;\\n            cursor: pointer;\\n            outline: none;\\n        }\\n        .lang-selector label {\\n            display: none;\\n        }\\n        .voice-recording {\\n            background: #dc3545 !important;\\n            animation: pulse 1.5s infinite;\\n        }\\n        @keyframes pulse {\\n            0%, 100% { opacity: 1; transform: scale(1); }\\n            50% { opacity: 0.8; transform: scale(1.02); }\\n        }\\n        #voice-status.recording {\\n            color: #dc3545;\\n            font-weight: bold;\\n        }\\n        #voice-status.processing {\\n            color: #667eea;\\n            font-weight: bold;\\n        }\\n        \\n        /* Mobile Optimizations */\\n        @media (max-width: 768px) {\\n            body {\\n                padding: 5px;\\n            }\\n            .container {\\n                padding: 12px;\\n                border-radius: 12px;\\n            }\\n            h1 {\\n                font-size: 20px;\\n                margin-bottom: 12px;\\n            }\\n            .status {\\n                padding: 10px;\\n                font-size: 14px;\\n                margin-bottom: 12px;\\n            }\\n            .control-section {\\n                margin-bottom: 15px;\\n            }\\n            .section-title {\\n                font-size: 16px;\\n                margin-bottom: 10px;\\n            }\\n            .portal-music-item {\\n                flex-direction: column;\\n                align-items: flex-start;\\n                gap: 10px;\\n            }\\n            .portal-music-select {\\n                width: 100%;\\n                text-align: center;\\n            }\\n            .volume-value {\\n                font-size: 16px;\\n            }\\n            .btn {\\n                padding: 16px 14px;\\n                font-size: 14px;\\n                min-height: 48px;\\n                border-radius: 10px;\\n            }\\n            .btn-direction {\\n                padding: 22px 12px;\\n                font-size: 18px;\\n                min-height: 65px;\\n            }\\n            .direction-grid {\\n                gap: 10px;\\n                padding: 8px;\\n            }\\n            .control-grid {\\n                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));\\n                gap: 8px;\\n            }\\n            .emoji-grid {\\n                grid-template-columns: repeat(3, 1fr);\\n                gap: 8px;\\n            }\\n            .emoji-btn {\\n                padding: 12px;\\n                font-size: 24px;\\n                min-height: 60px;\\n            }\\n            .lang-selector {\\n                top: 5px;\\n                right: 5px;\\n                padding: 6px 10px;\\n            }\\n            .lang-selector select {\\n                font-size: 12px;\\n                padding: 5px 8px;\\n            }\\n        }\\n        \\n        /* PWA Fullscreen Mode */\\n        @media (display-mode: standalone) {\\n            body {\\n                padding: 0;\\n            }\\n            .container {\\n                border-radius: 0;\\n                min-height: 100vh;\\n                padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);\\n            }\\n        }\\n        \\n        /* Landscape Mode Optimization */\\n        @media (max-width: 768px) and (orientation: landscape) {\\n            .container {\\n                padding: 8px;\\n            }\\n            .control-section {\\n                margin-bottom: 10px;\\n            }\\n            .btn-direction {\\n                padding: 18px 10px;\\n                font-size: 16px;\\n                min-height: 55px;\\n            }\\n        }\\n        \\n        /* Collapsible Sections for Mobile */\\n        .collapsible {\\n            cursor: pointer;\\n            user-select: none;\\n            -webkit-user-select: none;\\n            position: relative;\\n            padding-right: 30px;\\n        }\\n        .collapsible::after {\\n            content: \' ‚ñº\';\\n            font-size: 12px;\\n            position: absolute;\\n            right: 0;\\n            top: 50%;\\n            transform: translateY(-50%);\\n            transition: transform 0.3s;\\n        }\\n        .collapsible.collapsed::after {\\n            transform: translateY(-50%) rotate(-90deg);\\n        }\\n        .collapsible-content {\\n            max-height: 2000px;\\n            overflow: hidden;\\n            transition: max-height 0.3s ease-out, opacity 0.3s ease-out;\\n            opacity: 1;\\n        }\\n        .collapsible-content.collapsed {\\n            max-height: 0;\\n            opacity: 0;\\n            margin: 0;\\n            padding: 0;\\n        }\\n        \\n        /* Prevent text selection on buttons */\\n        .btn, .btn-direction, .emoji-btn {\\n            -webkit-touch-callout: none;\\n            -webkit-user-select: none;\\n            -khtml-user-select: none;\\n            -moz-user-select: none;\\n            -ms-user-select: none;\\n            user-select: none;\\n        }\\n        \\n        /* Prevent double-tap zoom on buttons */\\n        .btn, .btn-direction, .emoji-btn {\\n            touch-action: manipulation;\\n        }\\n        \\n        /* Better focus states for accessibility */\\n        .btn:focus-visible {\\n            outline: 3px solid #667eea;\\n            outline-offset: 2px;\\n        }\\n        </style>\\n    </noscript>\\n    <link rel=\"manifest\" href=\"/manifest.json\">\\n    <meta name=\"theme-color\" content=\"#667eea\">\\n    <meta name=\"apple-mobile-web-app-capable\" content=\"yes\">\\n    <meta name=\"apple-mobile-web-app-status-bar-style\" content=\"black-translucent\">\\n    <meta name=\"apple-mobile-web-app-title\" content=\"Otto Control\">\\n    <meta name=\"mobile-web-app-capable\" content=\"yes\">\\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover\">\\n    <meta name=\"format-detection\" content=\"telephone=no\">\\n</head>\\n<body>\\n    <!-- Menu Button (Pin) ·ªü g√≥c tr√°i -->\\n    <button class=\"menu-button\" onclick=\"toggleMenu()\" title=\"Menu\">üìå</button>\\n    <button class=\"menu-button menu-ai\" onclick=\"forceAiStart()\" title=\"K√≠ch ho·∫°t AI\">‚ö°</button>\\n    \\n    <!-- Menu Panel -->\\n    <div id=\"menu-panel\" class=\"menu-panel\">\\n        <div class=\"menu-item\" onclick=\"scanQRCode(); toggleMenu();\">\\n            üì∑ <span data-i18n=\"otto.scan_qr\">Scan QR Code</span>\\n        </div>\\n        <div class=\"menu-item\" onclick=\"showSavedDevices(); toggleMenu();\">\\n            üìã <span data-i18n=\"otto.saved_devices\">Saved Devices</span>\\n        </div>\\n        <div class=\"menu-item\" onclick=\"showQrCodeOnLCD(); toggleMenu();\">\\n            üì∫ <span data-i18n=\"otto.show_qr_lcd\">Show QR on LCD</span>\\n        </div>\\n        <div class=\"menu-item\" onclick=\"toggleVoiceControl(); toggleMenu();\">\\n            üé§ <span id=\"menu-voice-text\" data-i18n=\"otto.voice_start\">Start Voice Control</span>\\n        </div>\\n        <div class=\"menu-item\" onclick=\"forceAiStart()\">\\n            ‚ö° <span>K√≠ch ho·∫°t AI</span>\\n        </div>\\n        <div class=\"menu-item\" onclick=\"window.location.href=\'/servo-calibration\'\">\\n            ‚öôÔ∏è <span data-i18n=\"otto.open_servo_calibration\">Servo Calibration</span>\\n        </div>\\n        <div class=\"menu-item\" onclick=\"window.location.href=\'/\'\">\\n            ‚öôÔ∏è <span>Settings</span>\\n        </div>\\n    </div>\\n    \\n    <!-- QR Scanner (Hidden, shown when needed) -->\\n    <div id=\"qr-scanner\" style=\"display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.3); z-index: 2000; max-width: 90%; max-height: 90%;\">\\n        <div style=\"text-align: right; margin-bottom: 10px;\">\\n            <button onclick=\"stopQRScanner()\" style=\"background: #dc3545; color: white; border: none; padding: 5px 15px; border-radius: 6px; cursor: pointer;\">‚úï</button>\\n        </div>\\n        <video id=\"qr-video\" style=\"width: 100%; max-width: 300px; border-radius: 8px; background: black;\"></video>\\n        <canvas id=\"qr-canvas\" style=\"display: none;\"></canvas>\\n        <div id=\"qr-status\" style=\"margin-top: 10px; font-size: 14px; color: #666; text-align: center;\"></div>\\n    </div>\\n    \\n    <!-- Voice Status (Floating) -->\\n    <div id=\"voice-status\" style=\"display: none; position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: rgba(102, 126, 234, 0.95); color: white; padding: 12px 20px; border-radius: 25px; font-size: 14px; font-weight: bold; z-index: 1000; box-shadow: 0 4px 12px rgba(0,0,0,0.2);\"></div>\\n    <div id=\"voice-text\" style=\"display: none; position: fixed; bottom: 70px; left: 50%; transform: translateX(-50%); background: white; padding: 10px 15px; border-radius: 8px; font-size: 13px; color: #333; max-width: 80%; z-index: 1000; box-shadow: 0 4px 12px rgba(0,0,0,0.2);\"></div>\\n    \\n    <!-- Saved Devices List (Hidden, shown when needed) -->\\n    <div id=\"saved-devices-list\" style=\"display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.3); z-index: 2000; max-width: 90%; max-height: 80%; overflow-y: auto;\">\\n        <div style=\"text-align: right; margin-bottom: 10px;\">\\n            <button onclick=\"document.getElementById(\'saved-devices-list\').style.display=\'none\'\" style=\"background: #dc3545; color: white; border: none; padding: 5px 15px; border-radius: 6px; cursor: pointer;\">‚úï</button>\\n        </div>\\n        <h3 style=\"margin-bottom: 15px;\">üìã <span data-i18n=\"otto.saved_devices\">Saved Devices</span></h3>\\n        <div id=\"devices-container\" style=\"text-align: left;\"></div>\\n    </div>\\n    \\n    <div class=\"container\">\\n        <div class=\"lang-selector\">\\n            <label for=\"language\">üåê</label>\\n            <select id=\"language\" onchange=\"changeLanguage(this.value)\">\\n                <option value=\"zh-CN\">‰∏≠Êñá (ÁÆÄ‰Ωì)</option>\\n                <option value=\"zh-TW\">‰∏≠Êñá (ÁπÅÈ´î)</option>\\n                <option value=\"en-US\">English</option>\\n                <option value=\"ja-JP\">Êó•Êú¨Ë™û</option>\\n                <option value=\"ko-KR\">ÌïúÍµ≠Ïñ¥</option>\\n                <option value=\"vi-VN\">Ti·∫øng Vi·ªát</option>\\n                <option value=\"th-TH\">‡πÑ‡∏ó‡∏¢</option>\\n            </select>\\n        </div>\\n        <h1 data-i18n=\"otto.title\">ü§ñ Otto Robot Control</h1>\\n        <div id=\"status\" class=\"status idle\" data-i18n=\"otto.status.idle\">Status: Idle</div>\\n        \\n        <!-- Direction Control - Always Visible, Priority for Mobile -->\\n        <div class=\"control-section\" style=\"background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); border-left: 4px solid #4caf50; padding: 15px; border-radius: 12px;\">\\n            <h2 class=\"section-title\" data-i18n=\"otto.direction\" style=\"color: #2e7d32; border-color: #4caf50;\">üéÆ Direction Control (Gamepad)</h2>\\n            <div class=\"direction-grid\">\\n                <div></div>\\n                <button class=\"btn btn-direction\" onclick=\"sendCommand(\'walk_forward\')\" data-i18n=\"otto.forward\" style=\"background: #4caf50;\">‚¨ÜÔ∏è Forward</button>\\n                <div></div>\\n                <button class=\"btn btn-direction\" onclick=\"sendCommand(\'turn_left\')\" data-i18n=\"otto.left\" style=\"background: #2196f3;\">‚¨ÖÔ∏è Left</button>\\n                <button class=\"btn btn-direction btn stop\" onclick=\"sendCommand(\'stop\')\" data-i18n=\"otto.stop\">‚èπÔ∏è Stop</button>\\n                <button class=\"btn btn-direction\" onclick=\"sendCommand(\'turn_right\')\" data-i18n=\"otto.right\" style=\"background: #2196f3;\">‚û°Ô∏è Right</button>\\n                <div></div>\\n                <button class=\"btn btn-direction\" onclick=\"sendCommand(\'walk_backward\')\" data-i18n=\"otto.backward\" style=\"background: #4caf50;\">‚¨áÔ∏è Backward</button>\\n                <div></div>\\n            </div>\\n        </div>\\n\\n        <!-- Volume Control -->\\n        <div class=\"control-section volume-section\">\\n            <h2 class=\"section-title collapsible collapsed\" onclick=\"toggleSection(this)\">üîä Volume / √Çm l∆∞·ª£ng</h2>\\n            <div class=\"section-content collapsible-content collapsed\">\\n                <div class=\"volume-slider\">\\n                    <input type=\"range\" id=\"volume-slider\" min=\"0\" max=\"100\" value=\"70\" oninput=\"handleVolumeInput(this.value)\" aria-label=\"Volume slider\">\\n                    <div class=\"volume-value\" id=\"volume-value\">70%</div>\\n                </div>\\n            </div>\\n        </div>\\n        \\n        <!-- Collapsible Sections for Mobile -->\\n        <div class=\"control-section\">\\n            <h2 class=\"section-title collapsible\" onclick=\"toggleSection(this)\" data-i18n=\"otto.dance\">üíÉ Dance Moves</h2>\\n            <div class=\"collapsible-content\">\\n                <div class=\"control-grid\">\\n                    <button class=\"btn\" onclick=\"sendCommand(\'jump\')\" data-i18n=\"otto.jump\">Jump</button>\\n                    <button class=\"btn\" onclick=\"sendCommand(\'swing\')\" data-i18n=\"otto.swing\">Swing</button>\\n                    <button class=\"btn\" onclick=\"sendCommand(\'moonwalk\')\" data-i18n=\"otto.moonwalk\">Moonwalk</button>\\n                    <button class=\"btn\" onclick=\"sendCommand(\'bend\')\" data-i18n=\"otto.bend\">Bend</button>\\n                    <button class=\"btn\" onclick=\"sendCommand(\'shake_leg\')\" data-i18n=\"otto.shake_leg\">Shake Leg</button>\\n                    <button class=\"btn\" onclick=\"sendCommand(\'updown\')\" data-i18n=\"otto.updown\">Up & Down</button>\\n                    <button class=\"btn\" onclick=\"sendCommand(\'tiptoe_swing\')\" data-i18n=\"otto.tiptoe_swing\">Tiptoe Swing</button>\\n                    <button class=\"btn\" onclick=\"sendCommand(\'jitter\')\" data-i18n=\"otto.jitter\">Jitter</button>\\n                    <button class=\"btn\" onclick=\"sendCommand(\'ascending_turn\')\" data-i18n=\"otto.ascending_turn\">Ascending Turn</button>\\n                    <button class=\"btn\" onclick=\"sendCommand(\'crusaito\')\" data-i18n=\"otto.crusaito\">Crusaito</button>\\n                    <button class=\"btn\" onclick=\"sendCommand(\'flapping\')\" data-i18n=\"otto.flapping\">Flapping</button>\\n                </div>\\n            </div>\\n        </div>\\n        \\n        <div class=\"control-section\">\\n            <h2 class=\"section-title collapsible\" onclick=\"toggleSection(this)\" data-i18n=\"otto.hands\">üëã Hand Actions</h2>\\n            <div class=\"collapsible-content\">\\n                <div class=\"control-grid\">\\n                    <button class=\"btn\" onclick=\"sendCommand(\'hands_up\')\" data-i18n=\"otto.hands_up\">Hands Up</button>\\n                    <button class=\"btn\" onclick=\"sendCommand(\'hands_down\')\" data-i18n=\"otto.hands_down\">Hands Down</button>\\n                    <button class=\"btn\" onclick=\"sendCommand(\'hand_wave\')\" data-i18n=\"otto.hand_wave\">Hand Wave</button>\\n                </div>\\n            </div>\\n        </div>\\n        \\n        <div class=\"control-section\">\\n            <h2 class=\"section-title collapsible\" onclick=\"toggleSection(this)\" data-i18n=\"otto.emoji\">üòä Emoji Control</h2>\\n            <div class=\"collapsible-content\">\\n                <div class=\"emoji-grid\">\\n                    <button class=\"btn emoji-btn\" onclick=\"setEmoji(\'happy\')\" data-i18n=\"otto.emoji.happy\">üòä Happy</button>\\n                    <button class=\"btn emoji-btn\" onclick=\"setEmoji(\'sad\')\" data-i18n=\"otto.emoji.sad\">üò¢ Sad</button>\\n                    <button class=\"btn emoji-btn\" onclick=\"setEmoji(\'angry\')\" data-i18n=\"otto.emoji.angry\">üò† Angry</button>\\n                    <button class=\"btn emoji-btn\" onclick=\"setEmoji(\'surprised\')\" data-i18n=\"otto.emoji.surprised\">üò≤ Surprised</button>\\n                    <button class=\"btn emoji-btn\" onclick=\"setEmoji(\'thinking\')\" data-i18n=\"otto.emoji.thinking\">ü§î Thinking</button>\\n                    <button class=\"btn emoji-btn\" onclick=\"setEmoji(\'neutral\')\" data-i18n=\"otto.emoji.neutral\">üòê Neutral</button>\\n                </div>\\n            </div>\\n        </div>\\n        \\n        <div class=\"control-section\" style=\"background: linear-gradient(135deg, #fff5e6 0%, #ffe6cc 100%); border-left: 4px solid #ff9800;\">\\n            <h2 class=\"section-title\" data-i18n=\"otto.servo_calibration\">‚öôÔ∏è Servo Calibration (ƒêi·ªÅu Ch·ªânh G√≥c Servo)</h2>\\n            <div style=\"font-size: 12px; color: #666; margin-bottom: 20px;\" data-i18n=\"otto.servo_calibration_hint\">\\n                ƒêi·ªÅu ch·ªânh g√≥c c·ªßa t·ª´ng servo (0-180 ƒë·ªô) v√† trim (-50 ƒë·∫øn +50 ƒë·ªô). Trim ƒë∆∞·ª£c l∆∞u vƒ©nh vi·ªÖn.\\n            </div>\\n            <div style=\"text-align: center; margin: 20px 0;\">\\n                <a href=\"/servo-calibration\" style=\"display: inline-block; padding: 15px 30px; background: #ff9800; color: white; text-decoration: none; border-radius: 8px; font-weight: bold; font-size: 16px; transition: all 0.3s;\" onmouseover=\"this.style.background=\'#f57c00\'; this.style.transform=\'translateY(-2px)\';\" onmouseout=\"this.style.background=\'#ff9800\'; this.style.transform=\'translateY(0)\';\" data-i18n=\"otto.open_servo_calibration\">\\n                    üîß M·ªü Trang ƒêi·ªÅu Ch·ªânh Servo\\n                </a>\\n            </div>\\n        </div>\\n    </div>\\n    \\n    <!-- Fixed PWA Install Button (Bottom Right Corner) -->\\n    <div class=\"pwa-install-fixed\" id=\"pwa-install-button-fixed-otto\" style=\"position: fixed; bottom: 20px; right: 20px; background: rgba(255, 255, 255, 0.95); padding: 15px 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); z-index: 1000; backdrop-filter: blur(10px); text-align: center;\">\\n        <button onclick=\"installPWA()\" style=\"background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 20px; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 14px; transition: all 0.3s; box-shadow: 0 2px 8px rgba(0,0,0,0.2); display: flex; align-items: center; justify-content: center; gap: 8px; white-space: nowrap;\" \\n                onmouseover=\"this.style.transform=\'translateY(-2px)\'; this.style.boxShadow=\'0 4px 12px rgba(0,0,0,0.3)\';\" \\n                onmouseout=\"this.style.transform=\'translateY(0)\'; this.style.boxShadow=\'0 2px 8px rgba(0,0,0,0.2)\';\">\\n            üì± C√†i ƒë·∫∑t ·ª©ng d·ª•ng\\n        </button>\\n        <div style=\"font-size: 11px; color: #666; margin-top: 6px;\">\\n            Install App\\n        </div>\\n    </div>\\n    <script>\\n        // Hide PWA install button if on GitHub Pages App page or PWA is already installed\\n        // Using same simple logic as Settings page that works\\n        (function() {\\n            function shouldHidePWAButton() {\\n                // Check if on GitHub Pages App page\\n                const currentHost = window.location.hostname;\\n                if (currentHost === \'nguenvanky.github.io\' && window.location.pathname.startsWith(\'/App/\')) {\\n                    return true;\\n                }\\n                // Check if PWA is already installed - standalone mode\\n                if (window.matchMedia(\'(display-mode: standalone)\').matches) {\\n                    return true;\\n                }\\n                // Check iOS standalone mode\\n                if (window.navigator.standalone === true) {\\n                    return true;\\n                }\\n                // Check Android app mode\\n                if (document.referrer && document.referrer.includes(\'android-app://\')) {\\n                    return true;\\n                }\\n                // Additional check: window.navigator.standalone on iOS\\n                if (typeof navigator !== \'undefined\' && navigator.standalone === true) {\\n                    return true;\\n                }\\n                return false;\\n            }\\n            \\n            function hidePWAButton() {\\n                const pwaInstallButton = document.getElementById(\'pwa-install-button-fixed-otto\') || document.querySelector(\'.pwa-install-fixed\');\\n                if (pwaInstallButton && shouldHidePWAButton()) {\\n                    console.log(\'Hiding PWA install button - on App page or PWA installed\');\\n                    pwaInstallButton.style.display = \'none\';\\n                    pwaInstallButton.style.visibility = \'hidden\';\\n                    return true;\\n                }\\n                return false;\\n            }\\n            \\n            // Try to hide immediately\\n            if (document.readyState === \'loading\') {\\n                document.addEventListener(\'DOMContentLoaded\', function() {\\n                    hidePWAButton();\\n                    // Check again after a short delay\\n                    setTimeout(hidePWAButton, 100);\\n                    setTimeout(hidePWAButton, 500);\\n                    setTimeout(hidePWAButton, 1000);\\n                });\\n            } else {\\n                // DOM already loaded\\n                hidePWAButton();\\n                setTimeout(hidePWAButton, 100);\\n                setTimeout(hidePWAButton, 500);\\n                setTimeout(hidePWAButton, 1000);\\n            }\\n            \\n            // Listen for visibility change (when app goes to foreground/background)\\n            document.addEventListener(\'visibilitychange\', function() {\\n                if (!document.hidden) {\\n                    hidePWAButton();\\n                }\\n            });\\n            \\n            // Listen for appinstalled event\\n            window.addEventListener(\'appinstalled\', function() {\\n                console.log(\'PWA installed - hiding button\');\\n                hidePWAButton();\\n            });\\n            \\n            // Check periodically (every 2 seconds for first 10 seconds)\\n            let checkCount = 0;\\n            const checkInterval = setInterval(function() {\\n                if (hidePWAButton() || checkCount >= 5) {\\n                    clearInterval(checkInterval);\\n                }\\n                checkCount++;\\n            }, 2000);\\n        })();\\n    </script>\\n    \\n    <!-- Load JS from external -->\\n    <script>\\n        // Fallback loader functions\\n        function loadFallbackCSS(name) {\\n            console.warn(\'External CSS failed, trying fallback:\', name);\\n            const link = document.createElement(\'link\');\\n            link.rel = \'stylesheet\';\\n            link.href = \'/static/css/\' + name + \'.min.css\';\\n            link.onerror = function() {\\n                console.error(\'All CSS loading methods failed for:\', name);\\n            };\\n            document.head.appendChild(link);\\n        }\\n        \\n        function loadFallbackJS(name) {\\n            console.warn(\'External JS failed, trying fallback:\', name);\\n            const script = document.createElement(\'script\');\\n            script.src = \'/static/js/\' + name + \'.min.js\';\\n            script.onerror = function() {\\n                console.error(\'All JS loading methods failed for:\', name);\\n            };\\n            document.body.appendChild(script);\\n        }\\n    </script>\\n    <!-- Critical functions that must be available immediately -->\\n    <script>\\n        // Define critical functions immediately (before external JS loads)\\n        // These will be overridden by external JS if it loads successfully\\n        function showStatus(message, isError) {\\n            const status = document.getElementById(\'status\');\\n            if (status) {\\n                status.className = \'status \' + (isError ? \'error\' : \'success\');\\n                status.textContent = message;\\n                setTimeout(() => status.textContent = \'\', 3000);\\n            }\\n        }\\n        function sendCommand(command) {\\n            fetch(\'/api/otto/command\', {\\n                method: \'POST\',\\n                headers: { \'Content-Type\': \'application/json\' },\\n                body: JSON.stringify({ command: command })\\n            })\\n            .then(r => r.json())\\n            .then(d => {\\n                if (d.success) {\\n                    if (typeof updateStatus === \'function\') updateStatus();\\n                    else showStatus(\'Command sent: \' + command, false);\\n                } else {\\n                    showStatus(\'Error: \' + (d.error || \'Unknown error\'), true);\\n                }\\n            })\\n            .catch(e => showStatus(\'Error: \' + e, true));\\n        }\\n        function setEmoji(emotion) {\\n            fetch(\'/api/otto/emoji\', {\\n                method: \'POST\',\\n                headers: { \'Content-Type\': \'application/json\' },\\n                body: JSON.stringify({ emotion: emotion })\\n            })\\n            .then(r => r.json())\\n            .then(d => {\\n                if (!d.success) {\\n                    showStatus(\'Error: \' + (d.error || \'Unknown error\'), true);\\n                }\\n            })\\n            .catch(e => showStatus(\'Error: \' + e, true));\\n        }\\n        function forceAiStart() {\\n            fetch(\'/api/device/wake\', { method: \'POST\' })\\n            .then(r => r.json())\\n            .then(d => {\\n                if (d.success) {\\n                    showStatus(\'AI ƒë√£ ƒë∆∞·ª£c k√≠ch ho·∫°t!\', false);\\n                } else {\\n                    showStatus(\'L·ªói: \' + (d.error || \'Unknown error\'), true);\\n                }\\n            })\\n            .catch(e => showStatus(\'Error: \' + e, true));\\n        }\\n        function toggleMenu() {\\n            const panel = document.getElementById(\'menu-panel\');\\n            if (panel) panel.classList.toggle(\'show\');\\n        }\\n        // Toggle collapsible sections (for mobile)\\n        function toggleSection(element) {\\n            const content = element.nextElementSibling;\\n            if (content && content.classList.contains(\'collapsible-content\')) {\\n                element.classList.toggle(\'collapsed\');\\n                content.classList.toggle(\'collapsed\');\\n            }\\n        }\\n        // Language functions (minimal implementation)\\n        const translations = {\\n            \'zh-CN\': {}, \'zh-TW\': {}, \'en-US\': {}, \'vi-VN\': {}, \'ja-JP\': {}, \'ko-KR\': {}, \'th-TH\': {}\\n        };\\n        function getCurrentLanguage() {\\n            const saved = localStorage.getItem(\'otto_language\');\\n            if (saved && translations[saved]) return saved;\\n            const browserLang = navigator.language || navigator.userLanguage;\\n            if (browserLang.startsWith(\'zh\')) {\\n                return browserLang === \'zh-TW\' || browserLang === \'zh-Hant\' ? \'zh-TW\' : \'zh-CN\';\\n            }\\n            if (translations[browserLang]) return browserLang;\\n            return \'en-US\';\\n        }\\n        function changeLanguage(lang) {\\n            localStorage.setItem(\'otto_language\', lang);\\n            if (typeof updateTranslations === \'function\') {\\n                updateTranslations(lang);\\n            }\\n            const langSelect = document.getElementById(\'language\');\\n            if (langSelect) langSelect.value = lang;\\n        }\\n        // Voice control (minimal implementation)\\n        let isRecording = false;\\n        let recognition = null;\\n        const isSpeechSupported = \'webkitSpeechRecognition\' in window || \'SpeechRecognition\' in window;\\n        if (isSpeechSupported) {\\n            recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();\\n            recognition.continuous = false;\\n            recognition.interimResults = false;\\n        }\\n        function toggleVoiceControl() {\\n            if (!isSpeechSupported) {\\n                alert(\'Your browser does not support speech recognition. Please use Chrome, Edge, or Safari.\');\\n                return;\\n            }\\n            if (isRecording) {\\n                recognition.stop();\\n                isRecording = false;\\n            } else {\\n                try {\\n                    recognition.lang = getCurrentLanguage();\\n                    recognition.start();\\n                    isRecording = true;\\n                } catch (e) {\\n                    console.error(\'Failed to start recognition:\', e);\\n                    alert(\'Failed to start voice recognition. Please check microphone permissions.\');\\n                }\\n            }\\n        }\\n        // Volume control functions\\n        let volumeUpdateTimer = null;\\n        function updateVolumeDisplay(value) {\\n            const label = document.getElementById(\'volume-value\');\\n            if (label) {\\n                label.textContent = Math.round(value) + \'%\';\\n            }\\n        }\\n        function handleVolumeInput(value) {\\n            updateVolumeDisplay(value);\\n            if (volumeUpdateTimer) {\\n                clearTimeout(volumeUpdateTimer);\\n            }\\n            volumeUpdateTimer = setTimeout(() => {\\n                setDeviceVolume(value);\\n            }, 200);\\n        }\\n        async function setDeviceVolume(value) {\\n            const volume = parseInt(value, 10);\\n            if (isNaN(volume)) {\\n                return;\\n            }\\n            try {\\n                const res = await fetch(\'/api/audio/volume\', {\\n                    method: \'POST\',\\n                    headers: { \'Content-Type\': \'application/json\' },\\n                    body: JSON.stringify({ volume })\\n                });\\n                if (!res.ok) {\\n                    throw new Error(\'status \' + res.status);\\n                }\\n                const data = await res.json();\\n                if (!data.success) {\\n                    throw new Error(data.message || \'Failed to update volume\');\\n                }\\n            } catch (err) {\\n                console.error(\'setDeviceVolume error\', err);\\n                if (typeof showStatus === \'function\') {\\n                    showStatus(\'Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t √¢m l∆∞·ª£ng: \' + err.message, true);\\n                }\\n            }\\n        }\\n        // QR Code Scanner functions\\n        let qrStream = null;\\n        let qrVideo = null;\\n        let qrCanvas = null;\\n        let qrContext = null;\\n        let qrScanInterval = null;\\n        function stopQRScanner() {\\n            if (qrScanInterval) {\\n                clearInterval(qrScanInterval);\\n                qrScanInterval = null;\\n            }\\n            if (qrStream) {\\n                qrStream.getTracks().forEach(track => track.stop());\\n                qrStream = null;\\n            }\\n            if (qrVideo) {\\n                qrVideo.srcObject = null;\\n            }\\n            const scannerDiv = document.getElementById(\'qr-scanner\');\\n            if (scannerDiv) scannerDiv.style.display = \'none\';\\n        }\\n        async function scanQRCode() {\\n            const scannerDiv = document.getElementById(\'qr-scanner\');\\n            if (scannerDiv) scannerDiv.style.display = \'block\';\\n            const statusDiv = document.getElementById(\'qr-status\');\\n            qrVideo = document.getElementById(\'qr-video\');\\n            qrCanvas = document.getElementById(\'qr-canvas\');\\n            if (!qrVideo || !qrCanvas) {\\n                alert(\'QR scanner elements not found\');\\n                return;\\n            }\\n            statusDiv.textContent = \'Requesting camera access...\';\\n            try {\\n                qrStream = await navigator.mediaDevices.getUserMedia({ \\n                    video: { facingMode: \'environment\', width: { ideal: 640 }, height: { ideal: 480 } } \\n                });\\n                qrVideo.srcObject = qrStream;\\n                qrVideo.setAttribute(\'playsinline\', true);\\n                qrVideo.play();\\n                qrContext = qrCanvas.getContext(\'2d\');\\n                qrCanvas.width = qrVideo.videoWidth;\\n                qrCanvas.height = qrVideo.videoHeight;\\n                statusDiv.textContent = \'Point camera at QR code...\';\\n                qrScanInterval = setInterval(function() {\\n                    if (qrVideo.readyState === qrVideo.HAVE_ENOUGH_DATA) {\\n                        qrContext.drawImage(qrVideo, 0, 0, qrCanvas.width, qrCanvas.height);\\n                        const imageData = qrContext.getImageData(0, 0, qrCanvas.width, qrCanvas.height);\\n                        if (window.jsQR) {\\n                            const code = jsQR(imageData.data, imageData.width, imageData.height);\\n                            if (code) {\\n                                statusDiv.textContent = \'QR code detected! Processing...\';\\n                                clearInterval(qrScanInterval);\\n                                stopQRScanner();\\n                                if (typeof handleQRCodeResult === \'function\') {\\n                                    handleQRCodeResult(code.data);\\n                                }\\n                            }\\n                        }\\n                    }\\n                }, 100);\\n            } catch (err) {\\n                console.error(\'Error accessing camera:\', err);\\n                statusDiv.textContent = \'Error: \' + err.message;\\n                statusDiv.style.color = \'#dc3545\';\\n            }\\n        }\\n        // Saved Devices functions\\n        function getSavedDevices() {\\n            const saved = localStorage.getItem(\'otto_saved_devices\');\\n            return saved ? JSON.parse(saved) : [];\\n        }\\n        async function showSavedDevices() {\\n            const devicesListDiv = document.getElementById(\'saved-devices-list\');\\n            const containerDiv = document.getElementById(\'devices-container\');\\n            const qrScannerDiv = document.getElementById(\'qr-scanner\');\\n            if (qrScannerDiv && qrScannerDiv.style.display !== \'none\') {\\n                stopQRScanner();\\n            }\\n            if (devicesListDiv) devicesListDiv.style.display = \'block\';\\n            const devices = getSavedDevices();\\n            if (devices.length === 0) {\\n                if (containerDiv) {\\n                    containerDiv.innerHTML = \'<p style=\"text-align: center; color: #666;\">No saved devices</p>\';\\n                }\\n                return;\\n            }\\n            if (containerDiv) {\\n                containerDiv.innerHTML = \'\';\\n                devices.forEach(device => {\\n                    const deviceDiv = document.createElement(\'div\');\\n                    deviceDiv.style.cssText = \'padding: 15px; margin: 10px 0; background: white; border-radius: 8px; border: 2px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center;\';\\n                    const infoDiv = document.createElement(\'div\');\\n                    infoDiv.innerHTML = `<div style=\"font-weight: bold; font-size: 16px; margin-bottom: 5px;\">${device.device_name}</div><div style=\"font-size: 14px; color: #666;\">${device.ip_address}:${device.port}</div>`;\\n                    const buttonDiv = document.createElement(\'div\');\\n                    buttonDiv.style.cssText = \'display: flex; gap: 10px;\';\\n                    const connectBtn = document.createElement(\'button\');\\n                    connectBtn.textContent = \'Connect\';\\n                    connectBtn.style.cssText = \'padding: 8px 16px; font-size: 14px; background: #059669; color: white; border: none; border-radius: 4px;\';\\n                    connectBtn.onclick = () => {\\n                        if (typeof connectToDevice === \'function\') {\\n                            connectToDevice(device);\\n                        } else {\\n                            window.location.href = `http://${device.ip_address}:${device.port}/otto`;\\n                        }\\n                    };\\n                    buttonDiv.appendChild(connectBtn);\\n                    deviceDiv.appendChild(infoDiv);\\n                    deviceDiv.appendChild(buttonDiv);\\n                    containerDiv.appendChild(deviceDiv);\\n                });\\n            }\\n        }\\n        async function showQrCodeOnLCD() {\\n            try {\\n                showStatus(\'ƒêang hi·ªÉn th·ªã QR code l√™n m√†n h√¨nh LCD...\', false);\\n                const res = await fetch(\'/api/device/show-qr\', {\\n                    method: \'POST\',\\n                    headers: { \'Content-Type\': \'application/json\' },\\n                    body: JSON.stringify({ qr_data: window.location.origin })\\n                });\\n                if (!res.ok) {\\n                    const errorText = await res.text();\\n                    console.error(\'Failed to show QR code, status:\', res.status, errorText);\\n                    showStatus(\'L·ªói khi hi·ªÉn th·ªã QR code: \' + res.status, true);\\n                    return;\\n                }\\n                const data = await res.json();\\n                if (data.success) {\\n                    showStatus(\'‚úÖ QR code ƒë√£ ƒë∆∞·ª£c hi·ªÉn th·ªã tr√™n m√†n h√¨nh LCD!\', false);\\n                    console.log(\'QR code displayed on LCD:\', data.qr_data || window.location.origin);\\n                } else {\\n                    const errorMsg = data.error || \'Failed to show QR code\';\\n                    console.error(\'Error showing QR code:\', errorMsg);\\n                    showStatus(\'L·ªói: \' + errorMsg, true);\\n                }\\n            } catch (e) {\\n                console.error(\'Error showing QR code:\', e.message);\\n                showStatus(\'L·ªói k·∫øt n·ªëi: \' + e.message, true);\\n            }\\n        }\\n        \\n        // PWA Install function (minimal fallback for Otto page)\\n        function isOnAppPage() {\\n            const currentHost = window.location.hostname;\\n            return currentHost === \'nguenvanky.github.io\' && window.location.pathname.startsWith(\'/App/\');\\n        }\\n        \\n        function isPWAInstalled() {\\n            // Check if running as PWA\\n            if (window.matchMedia(\'(display-mode: standalone)\').matches ||\\n                window.navigator.standalone === true ||\\n                document.referrer.includes(\'android-app://\')) {\\n                return true;\\n            }\\n            // Check if on GitHub Pages App URL\\n            const currentHost = window.location.hostname;\\n            if (currentHost === \'nguenvanky.github.io\' && window.location.pathname.startsWith(\'/App/\')) {\\n                return true;\\n            }\\n            return false;\\n        }\\n        \\n        function hidePWAInstallButton() {\\n            const pwaInstallButton = document.getElementById(\'pwa-install-button-fixed-otto\') || document.querySelector(\'.pwa-install-fixed\');\\n            if (pwaInstallButton) {\\n                if (isOnAppPage() || isPWAInstalled()) {\\n                    console.log(\'Hiding PWA install button - on App page or PWA installed\');\\n                    pwaInstallButton.style.display = \'none\';\\n                    pwaInstallButton.style.visibility = \'hidden\';\\n                    return true;\\n                } else {\\n                    pwaInstallButton.style.display = \'\';\\n                    pwaInstallButton.style.visibility = \'\';\\n                }\\n            }\\n            return false;\\n        }\\n        \\n        function installPWA() {\\n            console.log(\'installPWA called\');\\n            const pwaBanner = document.getElementById(\'pwa-install-banner\');\\n            if (pwaBanner) {\\n                pwaBanner.style.display = \'none\';\\n            }\\n            localStorage.setItem(\'pwa-banner-dismissed\', \'true\');\\n            // Hide button immediately\\n            const btn = document.getElementById(\'pwa-install-button-fixed-otto\') || document.querySelector(\'.pwa-install-fixed\');\\n            if (btn) {\\n                btn.style.display = \'none\';\\n                btn.style.visibility = \'hidden\';\\n            }\\n            const isAndroid = /Android/.test(navigator.userAgent);\\n            const isIOS = /iPhone|iPad|iPod/.test(navigator.userAgent);\\n            if (isAndroid) {\\n                window.location.href = \'https://nguenvanky.github.io/App/\';\\n            } else if (isIOS) {\\n                alert(\'üì± H∆∞·ªõng d·∫´n c√†i ƒë·∫∑t tr√™n iPhone/iPad:\\n\\n1. Nh·∫•n n√∫t Share (m≈©i t√™n l√™n ‚¨ÜÔ∏è) ·ªü thanh ƒë·ªãa ch·ªâ Safari\\n2. Cu·ªôn xu·ªëng v√† ch·ªçn \"Th√™m v√†o M√†n h√¨nh ch√≠nh\"\\n3. Nh·∫•n \"Th√™m\"\\n\\nüí° ·ª®ng d·ª•ng s·∫Ω l∆∞u tr·ª±c ti·∫øp trang Otto Control n√†y.\');\\n            } else {\\n                window.location.href = \'https://nguenvanky.github.io/App/\';\\n            }\\n        }\\n        \\n        // Hide button immediately if on GitHub Pages App page or PWA installed\\n        hidePWAInstallButton();\\n    </script>\\n    <script src=\"https://nguenvanky.github.io/App/scripts/otto.min.js?v=1.0.0\" \\n            onerror=\"loadFallbackJS(\'otto\')\"\\n            onload=\"\\n                // After external JS loads, check again to hide button (same as Settings page)\\n                setTimeout(function() {\\n                    const btn = document.getElementById(\'pwa-install-button-fixed-otto\') || document.querySelector(\'.pwa-install-fixed\');\\n                    if (btn) {\\n                        const currentHost = window.location.hostname;\\n                        const isOnApp = currentHost === \'nguenvanky.github.io\' && window.location.pathname.startsWith(\'/App/\');\\n                        const isInstalled = window.matchMedia(\'(display-mode: standalone)\').matches ||\\n                                          window.navigator.standalone === true ||\\n                                          (document.referrer && document.referrer.includes(\'android-app://\'));\\n                        if (isOnApp || isInstalled) {\\n                            console.log(\'Hiding PWA install button - on App page or PWA installed\');\\n                            btn.style.display = \'none\';\\n                            btn.style.visibility = \'hidden\';\\n                        }\\n                    }\\n                }, 500);\\n            \"></script>\\n    \\n    <!-- Fallback JS (minimal inline for offline mode) -->\\n    <noscript>\\n    <script>\\n        // Minimal fallback functions for noscript mode\\n        if (typeof showStatus === \'undefined\') {\\n            function showStatus(message, isError) {\\n                const status = document.getElementById(\'status\');\\n                if (status) {\\n                    status.className = \'status \' + (isError ? \'error\' : \'success\');\\n                    status.textContent = message;\\n                    setTimeout(() => status.textContent = \'\', 3000);\\n                }\\n            }\\n        }\\n        if (typeof sendCommand === \'undefined\') {\\n            function sendCommand(command) {\\n                fetch(\'/api/otto/command\', {\\n                    method: \'POST\',\\n                    headers: { \'Content-Type\': \'application/json\' },\\n                    body: JSON.stringify({ command: command })\\n                })\\n                .then(r => r.json())\\n                .then(d => {\\n                    if (d.success) {\\n                        showStatus(\'Command sent: \' + command, false);\\n                    } else {\\n                        showStatus(\'Error: \' + (d.error || \'Unknown error\'), true);\\n                    }\\n                })\\n                .catch(e => showStatus(\'Error: \' + e, true));\\n            }\\n        }\\n        if (typeof setEmoji === \'undefined\') {\\n            function setEmoji(emotion) {\\n                fetch(\'/api/otto/emoji\', {\\n                    method: \'POST\',\\n                    headers: { \'Content-Type\': \'application/json\' },\\n                    body: JSON.stringify({ emotion: emotion })\\n                })\\n                .then(r => r.json())\\n                .then(d => {\\n                    if (!d.success) {\\n                        showStatus(\'Error: \' + (d.error || \'Unknown error\'), true);\\n                    }\\n                })\\n                .catch(e => showStatus(\'Error: \' + e, true));\\n            }\\n        }\\n        // Language translations\\n        const translations = {\\n            \'zh-CN\': {\\n                \'otto.title\': \'ü§ñ Otto Êú∫Âô®‰∫∫ÊéßÂà∂\',\\n                \'otto.status.idle\': \'Áä∂ÊÄÅ: Á©∫Èó≤\',\\n                \'otto.status.moving\': \'Áä∂ÊÄÅ: ÁßªÂä®‰∏≠\',\\n                \'otto.direction\': \'ÊñπÂêëÊéßÂà∂\',\\n                \'otto.forward\': \'‚¨ÜÔ∏è ÂâçËøõ\',\\n                \'otto.left\': \'‚¨ÖÔ∏è Â∑¶ËΩ¨\',\\n                \'otto.right\': \'‚û°Ô∏è Âè≥ËΩ¨\',\\n                \'otto.backward\': \'‚¨áÔ∏è ÂêéÈÄÄ\',\\n                \'otto.stop\': \'‚èπÔ∏è ÂÅúÊ≠¢\',\\n                \'otto.dance\': \'ËàûËπàÂä®‰Ωú\',\\n                \'otto.jump\': \'Ë∑≥Ë∑É\',\\n                \'otto.swing\': \'ÊëáÊëÜ\',\\n                \'otto.moonwalk\': \'Â§™Á©∫Ê≠•\',\\n                \'otto.bend\': \'ÂºØËÖ∞\',\\n                \'otto.shake_leg\': \'ÊëáËÖø\',\\n                \'otto.updown\': \'‰∏ä‰∏ã\',\\n                \'otto.tiptoe_swing\': \'Ë∏ÆËÑöÊëáÊëÜ\',\\n                \'otto.jitter\': \'ÊäñÂä®\',\\n                \'otto.ascending_turn\': \'‰∏äÂçáËΩ¨Ë∫´\',\\n                \'otto.crusaito\': \'Crusaito\',\\n                \'otto.flapping\': \'ÊãçÊâì\',\\n                \'otto.hands\': \'ÊâãÈÉ®Âä®‰Ωú\',\\n                \'otto.hands_up\': \'‰∏æÊâã\',\\n                \'otto.hands_down\': \'ÊîæÊâã\',\\n                \'otto.hand_wave\': \'Êå•Êâã\',\\n                \'otto.emoji\': \'Ë°®ÊÉÖÊéßÂà∂\',\\n                \'otto.emoji.happy\': \'üòä ÂºÄÂøÉ\',\\n                \'otto.emoji.sad\': \'üò¢ ÈöæËøá\',\\n                \'otto.emoji.angry\': \'üò† ÁîüÊ∞î\',\\n                \'otto.emoji.surprised\': \'üò≤ ÊÉäËÆ∂\',\\n                \'otto.emoji.thinking\': \'ü§î ÊÄùËÄÉ\',\\n                \'otto.emoji.neutral\': \'üòê ‰∏≠ÊÄß\',\\n                \'otto.voice_control\': \'üé§ ËØ≠Èü≥ÊéßÂà∂ (ËØ≠Èü≥Êåá‰ª§)\',\\n                \'otto.voice_start\': \'üé§ ÂºÄÂßãËØ≠Èü≥ÊéßÂà∂\',\\n                \'otto.voice_stop\': \'‚èπÔ∏è ÂÅúÊ≠¢ÂΩïÈü≥\',\\n                \'otto.voice_hint\': \'ÁÇπÂáªÊåâÈíÆÂπ∂ËØ¥ËØù‰ª•ÊéßÂà∂OttoÊú∫Âô®‰∫∫„ÄÇAI‰ºöÁêÜËß£ÊÇ®ÁöÑÊåá‰ª§Âπ∂Ëá™Âä®ÊéßÂà∂Otto„ÄÇÁ§∫‰æã: \"Otto ÂâçËøõ\", \"Otto Ë∑≥Ë∑É\", \"Otto ÂÅúÊ≠¢\"\',\\n                \'otto.voice_status_recording\': \'üé§ Ê≠£Âú®ÂΩïÈü≥... ËØ∑ËØ¥ËØùÔºÅ\',\\n                \'otto.voice_status_processing\': \'ü§î Â§ÑÁêÜ‰∏≠... Ê≠£Âú®ÂèëÈÄÅÂà∞AI...\',\\n                \'otto.voice_status_sent\': \'‚úÖ Êåá‰ª§Â∑≤ÂèëÈÄÅÔºÅAIÊ≠£Âú®Â§ÑÁêÜ...\'\\n            },\\n            \'zh-TW\': {\\n                \'otto.title\': \'ü§ñ Otto Ê©üÂô®‰∫∫ÊéßÂà∂\',\\n                \'otto.status.idle\': \'ÁãÄÊÖã: ÈñíÁΩÆ\',\\n                \'otto.status.moving\': \'ÁãÄÊÖã: ÁßªÂãï‰∏≠\',\\n                \'otto.direction\': \'ÊñπÂêëÊéßÂà∂\',\\n                \'otto.forward\': \'‚¨ÜÔ∏è ÂâçÈÄ≤\',\\n                \'otto.left\': \'‚¨ÖÔ∏è Â∑¶ËΩâ\',\\n                \'otto.right\': \'‚û°Ô∏è Âè≥ËΩâ\',\\n                \'otto.backward\': \'‚¨áÔ∏è ÂæåÈÄÄ\',\\n                \'otto.stop\': \'‚èπÔ∏è ÂÅúÊ≠¢\',\\n                \'otto.dance\': \'ËàûËπàÂãï‰Ωú\',\\n                \'otto.jump\': \'Ë∑≥Ë∫ç\',\\n                \'otto.swing\': \'ÊêñÊì∫\',\\n                \'otto.moonwalk\': \'Â§™Á©∫Ê≠•\',\\n                \'otto.bend\': \'ÂΩéËÖ∞\',\\n                \'otto.shake_leg\': \'ÊêñËÖø\',\\n                \'otto.updown\': \'‰∏ä‰∏ã\',\\n                \'otto.tiptoe_swing\': \'Ë∏ÆËÖ≥ÊêñÊì∫\',\\n                \'otto.jitter\': \'ÊäñÂãï\',\\n                \'otto.ascending_turn\': \'‰∏äÂçáËΩâË∫´\',\\n                \'otto.crusaito\': \'Crusaito\',\\n                \'otto.flapping\': \'ÊãçÊâì\',\\n                \'otto.hands\': \'ÊâãÈÉ®Âãï‰Ωú\',\\n                \'otto.hands_up\': \'ËàâÊâã\',\\n                \'otto.hands_down\': \'ÊîæÊâã\',\\n                \'otto.hand_wave\': \'ÊèÆÊâã\',\\n                \'otto.emoji\': \'Ë°®ÊÉÖÊéßÂà∂\',\\n                \'otto.emoji.happy\': \'üòä ÈñãÂøÉ\',\\n                \'otto.emoji.sad\': \'üò¢ Èõ£ÈÅé\',\\n                \'otto.emoji.angry\': \'üò† ÁîüÊ∞£\',\\n                \'otto.emoji.surprised\': \'üò≤ È©öË®ù\',\\n                \'otto.emoji.thinking\': \'ü§î ÊÄùËÄÉ\',\\n                \'otto.emoji.neutral\': \'üòê ‰∏≠ÊÄß\',\\n                \'otto.voice_control\': \'üé§ Ë™ûÈü≥ÊéßÂà∂ (Ë™ûÈü≥Êåá‰ª§)\',\\n                \'otto.voice_start\': \'üé§ ÈñãÂßãË™ûÈü≥ÊéßÂà∂\',\\n                \'otto.voice_stop\': \'‚èπÔ∏è ÂÅúÊ≠¢ÈåÑÈü≥\',\\n                \'otto.voice_hint\': \'ÈªûÊìäÊåâÈàï‰∏¶Ë™™Ë©±‰ª•ÊéßÂà∂OttoÊ©üÂô®‰∫∫„ÄÇAIÊúÉÁêÜËß£ÊÇ®ÁöÑÊåá‰ª§‰∏¶Ëá™ÂãïÊéßÂà∂Otto„ÄÇÁØÑ‰æã: \"Otto ÂâçÈÄ≤\", \"Otto Ë∑≥Ë∫ç\", \"Otto ÂÅúÊ≠¢\"\',\\n                \'otto.voice_status_recording\': \'üé§ Ê≠£Âú®ÈåÑÈü≥... Ë´ãË™™Ë©±ÔºÅ\',\\n                \'otto.voice_status_processing\': \'ü§î ËôïÁêÜ‰∏≠... Ê≠£Âú®ÁôºÈÄÅÂà∞AI...\',\\n                \'otto.voice_status_sent\': \'‚úÖ Êåá‰ª§Â∑≤ÁôºÈÄÅÔºÅAIÊ≠£Âú®ËôïÁêÜ...\'\\n            },\\n            \'en-US\': {\\n                \'otto.title\': \'ü§ñ Otto Robot Control\',\\n                \'otto.status.idle\': \'Status: Idle\',\\n                \'otto.status.moving\': \'Status: Moving\',\\n                \'otto.direction\': \'Direction Control\',\\n                \'otto.forward\': \'‚¨ÜÔ∏è Forward\',\\n                \'otto.left\': \'‚¨ÖÔ∏è Left\',\\n                \'otto.right\': \'‚û°Ô∏è Right\',\\n                \'otto.backward\': \'‚¨áÔ∏è Backward\',\\n                \'otto.stop\': \'‚èπÔ∏è Stop\',\\n                \'otto.dance\': \'Dance Moves\',\\n                \'otto.jump\': \'Jump\',\\n                \'otto.swing\': \'Swing\',\\n                \'otto.moonwalk\': \'Moonwalk\',\\n                \'otto.bend\': \'Bend\',\\n                \'otto.shake_leg\': \'Shake Leg\',\\n                \'otto.updown\': \'Up & Down\',\\n                \'otto.tiptoe_swing\': \'Tiptoe Swing\',\\n                \'otto.jitter\': \'Jitter\',\\n                \'otto.ascending_turn\': \'Ascending Turn\',\\n                \'otto.crusaito\': \'Crusaito\',\\n                \'otto.flapping\': \'Flapping\',\\n                \'otto.hands\': \'Hand Actions\',\\n                \'otto.hands_up\': \'Hands Up\',\\n                \'otto.hands_down\': \'Hands Down\',\\n                \'otto.hand_wave\': \'Hand Wave\',\\n                \'otto.emoji\': \'Emoji Control\',\\n                \'otto.emoji.happy\': \'üòä Happy\',\\n                \'otto.emoji.sad\': \'üò¢ Sad\',\\n                \'otto.emoji.angry\': \'üò† Angry\',\\n                \'otto.emoji.surprised\': \'üò≤ Surprised\',\\n                \'otto.emoji.thinking\': \'ü§î Thinking\',\\n                \'otto.emoji.neutral\': \'üòê Neutral\',\\n                \'otto.voice_control\': \'üé§ Voice Control (Voice Command)\',\\n                \'otto.voice_start\': \'üé§ Start Voice Control\',\\n                \'otto.voice_stop\': \'‚èπÔ∏è Stop Recording\',\\n                \'otto.voice_hint\': \'Click the button and speak to control Otto robot. The AI will understand your commands and control Otto automatically. Examples: \"Otto go forward\", \"Otto jump\", \"Otto stop\"\',\\n                \'otto.voice_status_recording\': \'üé§ Recording... Speak now!\',\\n                \'otto.voice_status_processing\': \'ü§î Processing... Sending to AI...\',\\n                \'otto.voice_status_sent\': \'‚úÖ Command sent! AI is processing...\'\\n            },\\n            \'vi-VN\': {\\n                \'otto.title\': \'ü§ñ ƒêi·ªÅu Khi·ªÉn Robot Otto\',\\n                \'otto.status.idle\': \'Tr·∫°ng th√°i: Nh√†n r·ªói\',\\n                \'otto.status.moving\': \'Tr·∫°ng th√°i: ƒêang di chuy·ªÉn\',\\n                \'otto.direction\': \'ƒêi·ªÅu Khi·ªÉn H∆∞·ªõng\',\\n                \'otto.forward\': \'‚¨ÜÔ∏è Ti·∫øn\',\\n                \'otto.left\': \'‚¨ÖÔ∏è Tr√°i\',\\n                \'otto.right\': \'‚û°Ô∏è Ph·∫£i\',\\n                \'otto.backward\': \'‚¨áÔ∏è L√πi\',\\n                \'otto.stop\': \'‚èπÔ∏è D·ª´ng\',\\n                \'otto.dance\': \'ƒê·ªông T√°c Nh·∫£y\',\\n                \'otto.jump\': \'Nh·∫£y\',\\n                \'otto.swing\': \'ƒêu ƒê∆∞a\',\\n                \'otto.moonwalk\': \'Moonwalk\',\\n                \'otto.bend\': \'C√∫i\',\\n                \'otto.shake_leg\': \'L·∫Øc Ch√¢n\',\\n                \'otto.updown\': \'L√™n & Xu·ªëng\',\\n                \'otto.tiptoe_swing\': \'ƒêu ƒê∆∞a Nh√≥n Ch√¢n\',\\n                \'otto.jitter\': \'Rung\',\\n                \'otto.ascending_turn\': \'Xoay L√™n\',\\n                \'otto.crusaito\': \'Crusaito\',\\n                \'otto.flapping\': \'V·ªó\',\\n                \'otto.hands\': \'ƒê·ªông T√°c Tay\',\\n                \'otto.hands_up\': \'Gi∆° Tay\',\\n                \'otto.hands_down\': \'H·∫° Tay\',\\n                \'otto.hand_wave\': \'V·∫´y Tay\',\\n                \'otto.emoji\': \'ƒêi·ªÅu Khi·ªÉn Emoji\',\\n                \'otto.emoji.happy\': \'üòä Vui\',\\n                \'otto.emoji.sad\': \'üò¢ Bu·ªìn\',\\n                \'otto.emoji.angry\': \'üò† Gi·∫≠n\',\\n                \'otto.emoji.surprised\': \'üò≤ Ng·∫°c Nhi√™n\',\\n                \'otto.emoji.thinking\': \'ü§î Suy Nghƒ©\',\\n                \'otto.emoji.neutral\': \'üòê Trung T√≠nh\',\\n                \'otto.voice_control\': \'üé§ ƒêi·ªÅu Khi·ªÉn Gi·ªçng N√≥i (L·ªánh Gi·ªçng N√≥i)\',\\n                \'otto.voice_start\': \'üé§ B·∫Øt ƒê·∫ßu ƒêi·ªÅu Khi·ªÉn Gi·ªçng N√≥i\',\\n                \'otto.voice_stop\': \'‚èπÔ∏è D·ª´ng Ghi √Çm\',\\n                \'otto.voice_hint\': \'Nh·∫•n n√∫t v√† n√≥i ƒë·ªÉ ƒëi·ªÅu khi·ªÉn robot Otto. AI s·∫Ω hi·ªÉu l·ªánh c·ªßa b·∫°n v√† t·ª± ƒë·ªông ƒëi·ªÅu khi·ªÉn Otto. V√≠ d·ª•: \"Otto ƒëi v·ªÅ ph√≠a tr∆∞·ªõc\", \"Otto nh·∫£y\", \"Otto d·ª´ng l·∫°i\"\',\\n                \'otto.voice_status_recording\': \'üé§ ƒêang ghi √¢m... Vui l√≤ng n√≥i!\',\\n                \'otto.voice_status_processing\': \'ü§î ƒêang x·ª≠ l√Ω... ƒêang g·ª≠i ƒë·∫øn AI...\',\\n                \'otto.voice_status_sent\': \'‚úÖ L·ªánh ƒë√£ ƒë∆∞·ª£c g·ª≠i! AI ƒëang x·ª≠ l√Ω...\'\\n            },\\n            \'zh-CN\': {\\n                \'otto.title\': \'ü§ñ Otto Êú∫Âô®‰∫∫ÊéßÂà∂\',\\n                \'otto.status.idle\': \'Áä∂ÊÄÅ: Á©∫Èó≤\',\\n                \'otto.status.moving\': \'Áä∂ÊÄÅ: ÁßªÂä®‰∏≠\',\\n                \'otto.direction\': \'ÊñπÂêëÊéßÂà∂\',\\n                \'otto.forward\': \'‚¨ÜÔ∏è ÂâçËøõ\',\\n                \'otto.left\': \'‚¨ÖÔ∏è Â∑¶ËΩ¨\',\\n                \'otto.right\': \'‚û°Ô∏è Âè≥ËΩ¨\',\\n                \'otto.backward\': \'‚¨áÔ∏è ÂêéÈÄÄ\',\\n                \'otto.stop\': \'‚èπÔ∏è ÂÅúÊ≠¢\',\\n                \'otto.dance\': \'ËàûËπàÂä®‰Ωú\',\\n                \'otto.jump\': \'Ë∑≥Ë∑É\',\\n                \'otto.swing\': \'ÊëáÊëÜ\',\\n                \'otto.moonwalk\': \'Â§™Á©∫Ê≠•\',\\n                \'otto.bend\': \'ÂºØËÖ∞\',\\n                \'otto.shake_leg\': \'ÊëáËÖø\',\\n                \'otto.updown\': \'‰∏ä‰∏ã\',\\n                \'otto.tiptoe_swing\': \'Ë∏ÆËÑöÊëáÊëÜ\',\\n                \'otto.jitter\': \'ÊäñÂä®\',\\n                \'otto.ascending_turn\': \'‰∏äÂçáËΩ¨Ë∫´\',\\n                \'otto.crusaito\': \'Crusaito\',\\n                \'otto.flapping\': \'ÊãçÊâì\',\\n                \'otto.hands\': \'ÊâãÈÉ®Âä®‰Ωú\',\\n                \'otto.hands_up\': \'‰∏æÊâã\',\\n                \'otto.hands_down\': \'ÊîæÊâã\',\\n                \'otto.hand_wave\': \'Êå•Êâã\',\\n                \'otto.emoji\': \'Ë°®ÊÉÖÊéßÂà∂\',\\n                \'otto.emoji.happy\': \'üòä ÂºÄÂøÉ\',\\n                \'otto.emoji.sad\': \'üò¢ ÈöæËøá\',\\n                \'otto.emoji.angry\': \'üò† ÁîüÊ∞î\',\\n                \'otto.emoji.surprised\': \'üò≤ ÊÉäËÆ∂\',\\n                \'otto.emoji.thinking\': \'ü§î ÊÄùËÄÉ\',\\n                \'otto.emoji.neutral\': \'üòê ‰∏≠ÊÄß\',\\n                \'otto.voice_control\': \'üé§ ËØ≠Èü≥ÊéßÂà∂ (ËØ≠Èü≥Êåá‰ª§)\',\\n                \'otto.voice_start\': \'üé§ ÂºÄÂßãËØ≠Èü≥ÊéßÂà∂\',\\n                \'otto.voice_stop\': \'‚èπÔ∏è ÂÅúÊ≠¢ÂΩïÈü≥\',\\n                \'otto.voice_hint\': \'ÁÇπÂáªÊåâÈíÆÂπ∂ËØ¥ËØù‰ª•ÊéßÂà∂OttoÊú∫Âô®‰∫∫„ÄÇAI‰ºöÁêÜËß£ÊÇ®ÁöÑÊåá‰ª§Âπ∂Ëá™Âä®ÊéßÂà∂Otto„ÄÇÁ§∫‰æã: \"Otto ÂâçËøõ\", \"Otto Ë∑≥Ë∑É\", \"Otto ÂÅúÊ≠¢\"\',\\n                \'otto.voice_status_recording\': \'üé§ Ê≠£Âú®ÂΩïÈü≥... ËØ∑ËØ¥ËØùÔºÅ\',\\n                \'otto.voice_status_processing\': \'ü§î Â§ÑÁêÜ‰∏≠... Ê≠£Âú®ÂèëÈÄÅÂà∞AI...\',\\n                \'otto.voice_status_sent\': \'‚úÖ Êåá‰ª§Â∑≤ÂèëÈÄÅÔºÅAIÊ≠£Âú®Â§ÑÁêÜ...\',\\n                \'otto.device_discovery\': \'üîç ËÆæÂ§áÂèëÁé∞\',\\n                \'otto.scan_qr\': \'üì∑ Êâ´Êèè‰∫åÁª¥Á†Å\',\\n                \'otto.saved_devices\': \'üìã Â∑≤‰øùÂ≠òËÆæÂ§á\',\\n                \'otto.stop_scan\': \'ÂÅúÊ≠¢Êâ´Êèè\',\\n                \'otto.no_device_found\': \'Êú™ÊâæÂà∞ËÆæÂ§á\',\\n                \'otto.connect\': \'ËøûÊé•\',\\n                \'otto.disconnect\': \'Êñ≠ÂºÄËøûÊé•\',\\n                \'otto.remove\': \'Âà†Èô§\',\\n                \'otto.online\': \'Âú®Á∫ø\',\\n                \'otto.offline\': \'Á¶ªÁ∫ø\',\\n                \'otto.show_qr_lcd\': \'üì∫ Âú®LCDÊòæÁ§∫QRÁ†Å\'\\n            },\\n            \'zh-TW\': {\\n                \'otto.device_discovery\': \'üîç Ë£ùÁΩÆÁôºÁèæ\',\\n                \'otto.scan_qr\': \'üì∑ ÊéÉÊèè QR Code\',\\n                \'otto.saved_devices\': \'üìã Â∑≤ÂÑ≤Â≠òË£ùÁΩÆ\',\\n                \'otto.stop_scan\': \'ÂÅúÊ≠¢ÊéÉÊèè\',\\n                \'otto.no_device_found\': \'Êâæ‰∏çÂà∞Ë£ùÁΩÆ\',\\n                \'otto.connect\': \'ÈÄ£Êé•\',\\n                \'otto.disconnect\': \'Êñ∑ÈñãÈÄ£Êé•\',\\n                \'otto.remove\': \'Âà™Èô§\',\\n                \'otto.online\': \'Á∑ö‰∏ä\',\\n                \'otto.offline\': \'Èõ¢Á∑ö\',\\n                \'otto.show_qr_lcd\': \'üì∫ Âú®LCDÈ°ØÁ§∫QRÁ¢º\'\\n            },\\n            \'vi-VN\': {\\n                \'otto.device_discovery\': \'üîç T√¨m Thi·∫øt B·ªã\',\\n                \'otto.scan_qr\': \'üì∑ Qu√©t QR Code\',\\n                \'otto.saved_devices\': \'üìã Thi·∫øt B·ªã ƒê√£ L∆∞u\',\\n                \'otto.stop_scan\': \'D·ª´ng Qu√©t\',\\n                \'otto.no_device_found\': \'Kh√¥ng t√¨m th·∫•y thi·∫øt b·ªã\',\\n                \'otto.connect\': \'K·∫øt N·ªëi\',\\n                \'otto.disconnect\': \'Ng·∫Øt K·∫øt N·ªëi\',\\n                \'otto.remove\': \'X√≥a\',\\n                \'otto.online\': \'Tr·ª±c Tuy·∫øn\',\\n                \'otto.offline\': \'Ngo·∫°i Tuy·∫øn\',\\n                \'otto.show_qr_lcd\': \'üì∫ Hi·ªÉn Th·ªã QR Tr√™n LCD\'\\n            },\\n            \'en-US\': {\\n                \'otto.show_qr_lcd\': \'üì∫ Show QR on LCD\'\\n            },\\n            \'ja-JP\': {\\n                \'otto.show_qr_lcd\': \'üì∫ LCD„Å´QR„Ç≥„Éº„Éâ„ÇíË°®Á§∫\'\\n            },\\n            \'ko-KR\': {\\n                \'otto.show_qr_lcd\': \'üì∫ LCDÏóê QR ÌëúÏãú\'\\n            },\\n            \'th-TH\': {\\n                \'otto.show_qr_lcd\': \'üì∫ ‡πÅ‡∏™‡∏î‡∏á QR ‡∏ö‡∏ô LCD\'\\n            }\\n        };\\n        \\n        // Get saved language or detect browser language\\n        function getCurrentLanguage() {\\n            const saved = localStorage.getItem(\'otto_language\');\\n            if (saved && translations[saved]) return saved;\\n            const browserLang = navigator.language || navigator.userLanguage;\\n            if (browserLang.startsWith(\'zh\')) {\\n                return browserLang === \'zh-TW\' || browserLang === \'zh-Hant\' ? \'zh-TW\' : \'zh-CN\';\\n            }\\n            if (translations[browserLang]) return browserLang;\\n            return \'en-US\'; // Default\\n        }\\n        \\n        // Change language\\n        function changeLanguage(lang) {\\n            localStorage.setItem(\'otto_language\', lang);\\n            updateTranslations(lang);\\n        }\\n        \\n        // Update translations\\n        function updateTranslations(lang) {\\n            const t = translations[lang] || translations[\'en-US\'];\\n            document.querySelectorAll(\'[data-i18n]\').forEach(el => {\\n                const key = el.getAttribute(\'data-i18n\');\\n                if (t[key]) {\\n                    if (el.tagName === \'INPUT\' || el.tagName === \'TEXTAREA\') {\\n                        el.placeholder = t[key];\\n                    } else {\\n                        el.textContent = t[key];\\n                    }\\n                }\\n            });\\n            document.getElementById(\'language\').value = lang;\\n        }\\n        \\n        // Initialize language on page load\\n        const currentLang = getCurrentLanguage();\\n        updateTranslations(currentLang);\\n        \\n        // QR Code Scanner using jsQR library (loaded from CDN)\\n        let qrStream = null;\\n        let qrVideo = null;\\n        let qrCanvas = null;\\n        let qrContext = null;\\n        let qrScanInterval = null;\\n        \\n        // Load jsQR library\\n        if (!window.jsQR) {\\n            const script = document.createElement(\'script\');\\n            script.src = \'https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js\';\\n            script.onload = function() {\\n                console.log(\'jsQR library loaded\');\\n            };\\n            document.head.appendChild(script);\\n        }\\n        \\n        async function scanQRCode() {\\n            const scannerDiv = document.getElementById(\'qr-scanner\');\\n            if (scannerDiv) {\\n                scannerDiv.style.display = \'block\';\\n            }\\n            const statusDiv = document.getElementById(\'qr-status\');\\n            qrVideo = document.getElementById(\'qr-video\');\\n            qrCanvas = document.getElementById(\'qr-canvas\');\\n            \\n            if (!qrVideo || !qrCanvas) {\\n                alert(\'QR scanner elements not found\');\\n                return;\\n            }\\n            \\n            scannerDiv.style.display = \'block\';\\n            statusDiv.textContent = \'Requesting camera access...\';\\n            \\n            try {\\n                qrStream = await navigator.mediaDevices.getUserMedia({ \\n                    video: { \\n                        facingMode: \'environment\', // Use back camera on mobile\\n                        width: { ideal: 640 },\\n                        height: { ideal: 480 }\\n                    } \\n                });\\n                qrVideo.srcObject = qrStream;\\n                qrVideo.setAttribute(\'playsinline\', true);\\n                qrVideo.play();\\n                \\n                qrContext = qrCanvas.getContext(\'2d\');\\n                qrCanvas.width = qrVideo.videoWidth;\\n                qrCanvas.height = qrVideo.videoHeight;\\n                \\n                statusDiv.textContent = \'Point camera at QR code...\';\\n                \\n                // Start scanning\\n                qrScanInterval = setInterval(function() {\\n                    if (qrVideo.readyState === qrVideo.HAVE_ENOUGH_DATA) {\\n                        qrContext.drawImage(qrVideo, 0, 0, qrCanvas.width, qrCanvas.height);\\n                        const imageData = qrContext.getImageData(0, 0, qrCanvas.width, qrCanvas.height);\\n                        \\n                        if (window.jsQR) {\\n                            const code = jsQR(imageData.data, imageData.width, imageData.height);\\n                            if (code) {\\n                                statusDiv.textContent = \'QR code detected! Processing...\';\\n                                clearInterval(qrScanInterval);\\n                                stopQRScanner();\\n                                handleQRCodeResult(code.data);\\n                            }\\n                        }\\n                    }\\n                }, 100); // Scan every 100ms\\n            } catch (err) {\\n                console.error(\'Error accessing camera:\', err);\\n                statusDiv.textContent = \'Error: \' + err.message;\\n                statusDiv.style.color = \'#dc3545\';\\n            }\\n        }\\n        \\n        function stopQRScanner() {\\n            if (qrScanInterval) {\\n                clearInterval(qrScanInterval);\\n                qrScanInterval = null;\\n            }\\n            if (qrStream) {\\n                qrStream.getTracks().forEach(track => track.stop());\\n                qrStream = null;\\n            }\\n            if (qrVideo) {\\n                qrVideo.srcObject = null;\\n            }\\n            document.getElementById(\'qr-scanner\').style.display = \'none\';\\n        }\\n        \\n        async function handleQRCodeResult(qrData) {\\n            try {\\n                // Parse QR code data (should be JSON with device info)\\n                let deviceInfo;\\n                if (qrData.startsWith(\'{\')) {\\n                    deviceInfo = JSON.parse(qrData);\\n                } else {\\n                    // If QR code is just URL, try to fetch device info\\n                    const url = qrData.startsWith(\'http\') ? qrData : \'http://\' + qrData;\\n                    const response = await fetch(url + \'/api/device/info\');\\n                    deviceInfo = await response.json();\\n                }\\n                \\n                // Save device and connect\\n                if (deviceInfo.ip_address && deviceInfo.port) {\\n                    saveDevice(deviceInfo);\\n                    connectToDevice(deviceInfo);\\n                } else {\\n                    alert(\'Invalid QR code: missing IP address or port\');\\n                }\\n            } catch (err) {\\n                console.error(\'Error processing QR code:\', err);\\n                alert(\'Error processing QR code: \' + err.message);\\n            }\\n        }\\n        \\n        // Saved Devices Management\\n        function saveDevice(deviceInfo) {\\n            const devices = getSavedDevices();\\n            const deviceId = deviceInfo.device_id || deviceInfo.ip_address;\\n            \\n            // Check if device already exists\\n            const existingIndex = devices.findIndex(d => d.device_id === deviceId);\\n            const device = {\\n                device_id: deviceId,\\n                device_name: deviceInfo.device_name || \'Otto Robot\',\\n                ip_address: deviceInfo.ip_address,\\n                port: deviceInfo.port || 80,\\n                last_connected: Date.now()\\n            };\\n            \\n            if (existingIndex >= 0) {\\n                devices[existingIndex] = device;\\n            } else {\\n                devices.push(device);\\n            }\\n            \\n            localStorage.setItem(\'otto_saved_devices\', JSON.stringify(devices));\\n        }\\n        \\n        function getSavedDevices() {\\n            const saved = localStorage.getItem(\'otto_saved_devices\');\\n            return saved ? JSON.parse(saved) : [];\\n        }\\n        \\n        function removeDevice(deviceId) {\\n            const devices = getSavedDevices();\\n            const filtered = devices.filter(d => d.device_id !== deviceId);\\n            localStorage.setItem(\'otto_saved_devices\', JSON.stringify(filtered));\\n            showSavedDevices();\\n        }\\n        \\n        async function showSavedDevices() {\\n            const devicesListDiv = document.getElementById(\'saved-devices-list\');\\n            const containerDiv = document.getElementById(\'devices-container\');\\n            const qrScannerDiv = document.getElementById(\'qr-scanner\');\\n            \\n            if (qrScannerDiv && qrScannerDiv.style.display !== \'none\') {\\n                stopQRScanner();\\n            }\\n            \\n            if (devicesListDiv) {\\n                devicesListDiv.style.display = \'block\';\\n            }\\n            \\n            const devices = getSavedDevices();\\n            if (devices.length === 0) {\\n                containerDiv.innerHTML = \'<p style=\"text-align: center; color: #666;\">No saved devices</p>\';\\n                devicesListDiv.style.display = \'block\';\\n                return;\\n            }\\n            \\n            containerDiv.innerHTML = \'\';\\n            devices.forEach(device => {\\n                const deviceDiv = document.createElement(\'div\');\\n                deviceDiv.style.cssText = \'padding: 15px; margin: 10px 0; background: white; border-radius: 8px; border: 2px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center;\';\\n                \\n                const infoDiv = document.createElement(\'div\');\\n                infoDiv.innerHTML = `\\n                    <div style=\"font-weight: bold; font-size: 16px; margin-bottom: 5px;\">${device.device_name}</div>\\n                    <div style=\"font-size: 14px; color: #666;\">${device.ip_address}:${device.port}</div>\\n                    <div style=\"font-size: 12px; color: #999;\">Last connected: ${new Date(device.last_connected).toLocaleString()}</div>\\n                `;\\n                \\n                const buttonDiv = document.createElement(\'div\');\\n                buttonDiv.style.cssText = \'display: flex; gap: 10px;\';\\n                \\n                const connectBtn = document.createElement(\'button\');\\n                connectBtn.className = \'btn\';\\n                connectBtn.textContent = \'Connect\';\\n                connectBtn.style.cssText = \'padding: 8px 16px; font-size: 14px; background: #059669;\';\\n                connectBtn.onclick = () => connectToDevice(device);\\n                \\n                const removeBtn = document.createElement(\'button\');\\n                removeBtn.className = \'btn\';\\n                removeBtn.textContent = \'Remove\';\\n                removeBtn.style.cssText = \'padding: 8px 16px; font-size: 14px; background: #dc3545;\';\\n                removeBtn.onclick = () => removeDevice(device.device_id);\\n                \\n                buttonDiv.appendChild(connectBtn);\\n                buttonDiv.appendChild(removeBtn);\\n                deviceDiv.appendChild(infoDiv);\\n                deviceDiv.appendChild(buttonDiv);\\n                containerDiv.appendChild(deviceDiv);\\n            });\\n            \\n            devicesListDiv.style.display = \'block\';\\n        }\\n        \\n        async function connectToDevice(deviceInfo) {\\n            const ip = deviceInfo.ip_address;\\n            const port = deviceInfo.port || 80;\\n            const url = `http://${ip}:${port}/otto`;\\n            \\n            // Check if device is reachable\\n            try {\\n                const response = await fetch(`http://${ip}:${port}/api/device/info`, { \\n                    method: \'GET\',\\n                    timeout: 3000 \\n                });\\n                if (response.ok) {\\n                    // Update last connected time\\n                    saveDevice(deviceInfo);\\n                    // Redirect to device\\n                    window.location.href = url;\\n                } else {\\n                    alert(\'Device is offline or unreachable\');\\n                }\\n            } catch (err) {\\n                alert(\'Error connecting to device: \' + err.message);\\n            }\\n        }\\n        \\n        // Show QR code on LCD\\n        async function showQrCodeOnLCD() {\\n            try {\\n                const res = await fetch(\'/api/device/show-qr\', {\\n                    method: \'POST\',\\n                    headers: { \'Content-Type\': \'application/json\' }\\n                });\\n                \\n                // Check if response is OK\\n                if (!res.ok) {\\n                    console.error(\'Failed to show QR code, status:\', res.status);\\n                    return;\\n                }\\n                \\n                // Parse JSON response\\n                let data;\\n                try {\\n                    const text = await res.text();\\n                    data = JSON.parse(text);\\n                } catch (parseError) {\\n                    console.error(\'Failed to parse JSON response:\', parseError);\\n                    console.error(\'Response text:\', await res.text());\\n                    return;\\n                }\\n                \\n                if (data.success) {\\n                    console.log(\'QR code displayed on LCD:\', data.qr_data);\\n                    // Don\'t show alert on auto-load, only on button click\\n                    // alert(\'QR code displayed on LCD! Scan with your phone to connect.\');\\n                } else {\\n                    console.error(\'Error showing QR code:\', data.error || \'Failed to show QR code\');\\n                }\\n            } catch (e) {\\n                console.error(\'Error showing QR code:\', e.message);\\n            }\\n        }\\n        \\n        // Auto-show QR code on LCD when page loads\\n        window.addEventListener(\'load\', function() {\\n            // Initialize mobile UI\\n            initMobileUI();\\n            \\n            // Auto-show QR code on LCD when entering control page\\n            showQrCodeOnLCD();\\n            \\n            // Check for saved devices (for future auto-connect feature)\\n            const devices = getSavedDevices();\\n            if (devices.length > 0) {\\n                // Try to connect to most recently used device\\n                const lastDevice = devices.sort((a, b) => b.last_connected - a.last_connected)[0];\\n                // Check if we\'re already on that device\\n                const currentHost = window.location.hostname;\\n                if (currentHost !== lastDevice.ip_address) {\\n                    // Auto-connect only if not already connected\\n                    // connectToDevice(lastDevice); // Commented out to avoid auto-redirect\\n                }\\n            }\\n        });\\n        \\n        // Voice Control using Web Speech API\\n        let recognition = null;\\n        let isRecording = false;\\n        \\n        // Check if browser supports Speech Recognition\\n        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\\n        const isSpeechSupported = !!SpeechRecognition;\\n        \\n        if (isSpeechSupported) {\\n            recognition = new SpeechRecognition();\\n            recognition.continuous = false;\\n            recognition.interimResults = false;\\n            recognition.lang = getCurrentLanguage();\\n            \\n            recognition.onstart = function() {\\n                isRecording = true;\\n                updateVoiceButton(true);\\n                const statusEl = document.getElementById(\'voice-status\');\\n                if (statusEl) {\\n                    statusEl.style.display = \'block\';\\n                    statusEl.className = \'recording\';\\n                    const lang = getCurrentLanguage();\\n                    const t = translations[lang] || translations[\'en-US\'];\\n                    statusEl.textContent = t[\'otto.voice_status_recording\'] || \'üé§ Recording... Speak now!\';\\n                }\\n                // Update menu text\\n                const menuVoiceText = document.getElementById(\'menu-voice-text\');\\n                if (menuVoiceText) {\\n                    const lang = getCurrentLanguage();\\n                    const t = translations[lang] || translations[\'en-US\'];\\n                    menuVoiceText.textContent = t[\'otto.voice_stop\'] || \'‚èπÔ∏è Stop Recording\';\\n                }\\n            };\\n            \\n            recognition.onresult = function(event) {\\n                const transcript = event.results[0][0].transcript;\\n                const textEl = document.getElementById(\'voice-text\');\\n                if (textEl) {\\n                    textEl.style.display = \'block\';\\n                    textEl.textContent = transcript;\\n                }\\n                \\n                // Send to AI\\n                sendVoiceCommandToAI(transcript);\\n            };\\n            \\n            recognition.onerror = function(event) {\\n                console.error(\'Speech recognition error:\', event.error);\\n                isRecording = false;\\n                updateVoiceButton(false);\\n                const statusEl = document.getElementById(\'voice-status\');\\n                if (statusEl) {\\n                    statusEl.className = \'\';\\n                    statusEl.textContent = \'‚ùå Error: \' + event.error;\\n                    setTimeout(() => {\\n                        statusEl.style.display = \'none\';\\n                    }, 3000);\\n                }\\n            };\\n            \\n            recognition.onend = function() {\\n                isRecording = false;\\n                updateVoiceButton(false);\\n                const statusEl = document.getElementById(\'voice-status\');\\n                if (statusEl && statusEl.className === \'recording\') {\\n                    statusEl.className = \'\';\\n                    statusEl.textContent = \'\';\\n                    statusEl.style.display = \'none\';\\n                }\\n            };\\n        }\\n        \\n        function toggleVoiceControl() {\\n            if (!isSpeechSupported) {\\n                alert(\'Your browser does not support speech recognition. Please use Chrome, Edge, or Safari.\');\\n                return;\\n            }\\n            \\n            if (isRecording) {\\n                recognition.stop();\\n            } else {\\n                try {\\n                    recognition.lang = getCurrentLanguage();\\n                    recognition.start();\\n                } catch (e) {\\n                    console.error(\'Failed to start recognition:\', e);\\n                    alert(\'Failed to start voice recognition. Please check microphone permissions.\');\\n                }\\n            }\\n        }\\n        \\n        function updateVoiceButton(recording) {\\n            const btn = document.getElementById(\'voice-btn\');\\n            const lang = getCurrentLanguage();\\n            const t = translations[lang] || translations[\'en-US\'];\\n            \\n            if (recording) {\\n                btn.classList.add(\'voice-recording\');\\n                btn.textContent = t[\'otto.voice_stop\'] || \'‚èπÔ∏è Stop Recording\';\\n            } else {\\n                btn.classList.remove(\'voice-recording\');\\n                btn.textContent = t[\'otto.voice_start\'] || \'üé§ Start Voice Control\';\\n            }\\n        }\\n        \\n        async function sendVoiceCommandToAI(text) {\\n            const statusEl = document.getElementById(\'voice-status\');\\n            if (statusEl) {\\n                statusEl.style.display = \'block\';\\n                statusEl.className = \'processing\';\\n                const lang = getCurrentLanguage();\\n                const t = translations[lang] || translations[\'en-US\'];\\n                statusEl.textContent = t[\'otto.voice_status_processing\'] || \'ü§î Processing... Sending to AI...\';\\n            }\\n            \\n            try {\\n                const res = await fetch(\'/api/ai/send\', {\\n                    method: \'POST\',\\n                    headers: { \'Content-Type\': \'application/json\' },\\n                    body: JSON.stringify({ text: text })\\n                });\\n                const data = await res.json();\\n                \\n                if (data.success && statusEl) {\\n                    statusEl.className = \'\';\\n                    const lang = getCurrentLanguage();\\n                    const t = translations[lang] || translations[\'en-US\'];\\n                    statusEl.textContent = t[\'otto.voice_status_sent\'] || \'‚úÖ Command sent! AI is processing...\';\\n                    setTimeout(() => {\\n                        if (statusEl) {\\n                            statusEl.textContent = \'\';\\n                            statusEl.style.display = \'none\';\\n                        }\\n                        updateStatus();\\n                    }, 3000);\\n                } else {\\n                    statusEl.className = \'\';\\n                    statusEl.textContent = \'‚ùå Error: \' + (data.message || \'Failed to send command\');\\n                }\\n            } catch (e) {\\n                statusEl.className = \'\';\\n                statusEl.textContent = \'‚ùå Error: \' + e.message;\\n            }\\n        }\\n        \\n        let forceAiBusy = false;\\n        function notifyStatus(message, isError) {\\n            if (typeof showStatus === \'function\') {\\n                showStatus(message, !!isError);\\n            } else {\\n                if (isError) {\\n                    console.error(message);\\n                    alert(message);\\n                } else {\\n                    console.log(message);\\n                }\\n            }\\n        }\\n        let volumeUpdateTimer = null;\\n        function updateVolumeDisplay(value) {\\n            const label = document.getElementById(\'volume-value\');\\n            if (label) {\\n                label.textContent = Math.round(value) + \'%\';\\n            }\\n        }\\n        function handleVolumeInput(value) {\\n            updateVolumeDisplay(value);\\n            if (volumeUpdateTimer) {\\n                clearTimeout(volumeUpdateTimer);\\n            }\\n            volumeUpdateTimer = setTimeout(() => {\\n                setDeviceVolume(value);\\n            }, 200);\\n        }\\n        async function setDeviceVolume(value) {\\n            const volume = parseInt(value, 10);\\n            if (isNaN(volume)) {\\n                return;\\n            }\\n            try {\\n                const res = await fetch(\'/api/audio/volume\', {\\n                    method: \'POST\',\\n                    headers: { \'Content-Type\': \'application/json\' },\\n                    body: JSON.stringify({ volume })\\n                });\\n                if (!res.ok) {\\n                    throw new Error(\'status \' + res.status);\\n                }\\n                const data = await res.json();\\n                if (!data.success) {\\n                    throw new Error(data.message || \'Failed to update volume\');\\n                }\\n            } catch (err) {\\n                console.error(\'setDeviceVolume error\', err);\\n                notifyStatus(\'Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t √¢m l∆∞·ª£ng: \' + err.message, true);\\n            }\\n        }\\n        async function loadVolumeLevel() {\\n            try {\\n                const res = await fetch(\'/api/audio/volume\');\\n                if (!res.ok) {\\n                    throw new Error(\'status \' + res.status);\\n                }\\n                const data = await res.json();\\n                if (typeof data.volume === \'number\') {\\n                    const slider = document.getElementById(\'volume-slider\');\\n                    if (slider) {\\n                        slider.value = data.volume;\\n                        updateVolumeDisplay(data.volume);\\n                    }\\n                }\\n            } catch (err) {\\n                console.warn(\'Failed to load volume level\', err);\\n            }\\n        }\\n        document.addEventListener(\'DOMContentLoaded\', loadVolumeLevel);\\n        async function forceAiStart() {\\n            if (forceAiBusy) {\\n                notifyStatus(\'ƒêang k√≠ch ho·∫°t AI...\', false);\\n                return;\\n            }\\n            forceAiBusy = true;\\n            notifyStatus(\'ƒêang k√≠ch ho·∫°t AI...\', false);\\n            try {\\n                const res = await fetch(\'/api/device/wake\', { method: \'POST\' });\\n                if (!res.ok) {\\n                    throw new Error(\'status \' + res.status);\\n                }\\n                await res.json().catch(() => ({}));\\n                notifyStatus(\'AI ƒë√£ ƒë∆∞·ª£c k√≠ch ho·∫°t!\', false);\\n            } catch (err) {\\n                console.error(\'forceAiStart error\', err);\\n                notifyStatus(\'Kh√¥ng th·ªÉ k√≠ch ho·∫°t AI: \' + err.message, true);\\n            } finally {\\n                setTimeout(() => { forceAiBusy = false; }, 2000);\\n                const panel = document.getElementById(\'menu-panel\');\\n                if (panel) {\\n                    panel.classList.remove(\'show\');\\n                }\\n            }\\n        }\\n        \\n        // Toggle menu panel\\n        function toggleMenu() {\\n            const panel = document.getElementById(\'menu-panel\');\\n            if (panel) {\\n                panel.classList.toggle(\'show\');\\n            }\\n        }\\n        \\n        // Close menu when clicking outside\\n        document.addEventListener(\'click\', function(event) {\\n            const menuButton = document.querySelector(\'.menu-button\');\\n            const menuPanel = document.getElementById(\'menu-panel\');\\n            if (menuPanel && menuButton && !menuPanel.contains(event.target) && !menuButton.contains(event.target)) {\\n                menuPanel.classList.remove(\'show\');\\n            }\\n        });\\n        \\n        // Toggle collapsible sections (for mobile)\\n        function toggleSection(element) {\\n            const content = element.nextElementSibling;\\n            if (content && content.classList.contains(\'collapsible-content\')) {\\n                element.classList.toggle(\'collapsed\');\\n                content.classList.toggle(\'collapsed\');\\n            }\\n        }\\n        \\n        // Auto-collapse sections on mobile\\n        function initMobileUI() {\\n            if (window.innerWidth <= 768) {\\n                // Collapse all sections except direction control on mobile\\n                const collapsibles = document.querySelectorAll(\'.collapsible\');\\n                collapsibles.forEach(el => {\\n                    if (!el.closest(\'.control-section\').querySelector(\'.direction-grid\')) {\\n                        el.classList.add(\'collapsed\');\\n                        const content = el.nextElementSibling;\\n                        if (content && content.classList.contains(\'collapsible-content\')) {\\n                            content.classList.add(\'collapsed\');\\n                        }\\n                    }\\n                });\\n            }\\n        }\\n        \\n        // Handle window resize\\n        window.addEventListener(\'resize\', function() {\\n            if (window.innerWidth > 768) {\\n                // Expand all sections on desktop\\n                const collapsibles = document.querySelectorAll(\'.collapsible\');\\n                collapsibles.forEach(el => {\\n                    el.classList.remove(\'collapsed\');\\n                    const content = el.nextElementSibling;\\n                    if (content && content.classList.contains(\'collapsible-content\')) {\\n                        content.classList.remove(\'collapsed\');\\n                    }\\n                });\\n            }\\n        });\\n        \\n        function sendCommand(command) {\\n            // Haptic feedback on mobile (if supported)\\n            if (navigator.vibrate) {\\n                navigator.vibrate(50);\\n            }\\n            \\n            fetch(\'/api/otto/command\', {\\n                method: \'POST\',\\n                headers: { \'Content-Type\': \'application/json\' },\\n                body: JSON.stringify({ command: command })\\n            })\\n            .then(r => r.json())\\n            .then(d => {\\n                if (d.success) {\\n                    updateStatus();\\n                } else {\\n                    alert(\'Error: \' + (d.error || \'Unknown error\'));\\n                }\\n            })\\n            .catch(e => alert(\'Error: \' + e));\\n        }\\n        \\n        function setEmoji(emotion) {\\n            fetch(\'/api/otto/emoji\', {\\n                method: \'POST\',\\n                headers: { \'Content-Type\': \'application/json\' },\\n                body: JSON.stringify({ emotion: emotion })\\n            })\\n            .then(r => r.json())\\n            .then(d => {\\n                if (!d.success) {\\n                    alert(\'Error: \' + (d.error || \'Unknown error\'));\\n                }\\n            })\\n            .catch(e => alert(\'Error: \' + e));\\n        }\\n        \\n        function updateStatus() {\\n            fetch(\'/api/otto/status\')\\n            .then(r => r.json())\\n            .then(d => {\\n                const statusEl = document.getElementById(\'status\');\\n                const lang = getCurrentLanguage();\\n                const t = translations[lang] || translations[\'en-US\'];\\n                const statusText = t[\'otto.status.\' + d.status] || (\'Status: \' + d.status);\\n                statusEl.textContent = statusText;\\n                statusEl.className = \'status \' + d.status;\\n            })\\n            .catch(e => console.error(\'Status error:\', e));\\n        }\\n        \\n        // Update status every 500ms\\n        setInterval(updateStatus, 500);\\n        updateStatus();\\n        \\n        // Register Service Worker for PWA\\n        if (\'serviceWorker\' in navigator) {\\n            window.addEventListener(\'load\', function() {\\n                navigator.serviceWorker.register(\'/service-worker.js\')\\n                    .then(function(registration) {\\n                        console.log(\'ServiceWorker registration successful with scope: \', registration.scope);\\n                    })\\n                    .catch(function(err) {\\n                        console.log(\'ServiceWorker registration failed: \', err);\\n                    });\\n            });\\n        }\\n        \\n        // PWA Install Banner Logic - Auto Install\\n        let deferredPrompt = null;\\n        let pwaBanner = null;\\n        let pwaInstallBtn = null;\\n        \\n        // Initialize PWA elements when DOM is ready\\n        function initPWA() {\\n            pwaBanner = document.getElementById(\'pwa-install-banner\');\\n            pwaInstallBtn = document.getElementById(\'pwa-install-btn\');\\n            \\n            if (!pwaBanner) {\\n                console.warn(\'PWA banner element not found\');\\n                return;\\n            }\\n            \\n            console.log(\'PWA banner initialized\');\\n            \\n            // Check if already installed\\n            if (isPWAInstalled()) {\\n                console.log(\'PWA already installed, hiding banner\');\\n                pwaBanner.style.display = \'none\';\\n                return;\\n            }\\n            \\n            // Check if on GitHub Pages App page (kh√¥ng hi·ªÉn th·ªã banner ·ªü ƒë√≥)\\n            if (isOnAppPage()) {\\n                console.log(\'On GitHub Pages App page, hiding banner\');\\n                pwaBanner.style.display = \'none\';\\n                return;\\n            }\\n            \\n            // Check if banner was dismissed\\n            if (wasBannerDismissed()) {\\n                console.log(\'PWA banner was dismissed, hiding\');\\n                pwaBanner.style.display = \'none\';\\n                return;\\n            }\\n            \\n            // Show banner after 1 second (reduced from 3 for better UX)\\n            setTimeout(function() {\\n                if (pwaBanner && !isPWAInstalled() && !wasBannerDismissed() && !isOnAppPage()) {\\n                    console.log(\'Showing PWA install banner\');\\n                    pwaBanner.style.display = \'block\';\\n                }\\n            }, 1000);\\n        }\\n        \\n        // Check if already installed\\n        function isPWAInstalled() {\\n            // Check if running as PWA\\n            if (window.matchMedia(\'(display-mode: standalone)\').matches ||\\n                window.navigator.standalone === true ||\\n                document.referrer.includes(\'android-app://\')) {\\n                return true;\\n            }\\n            // Check if on GitHub Pages App URL (user ƒë√£ c√†i t·ª´ ƒë√≥)\\n            const currentHost = window.location.hostname;\\n            if (currentHost === \'nguenvanky.github.io\' && window.location.pathname.startsWith(\'/App/\')) {\\n                // N·∫øu ƒëang ·ªü trang App, xem nh∆∞ ƒë√£ c√†i ho·∫∑c kh√¥ng c·∫ßn hi·ªÉn th·ªã banner\\n                return true;\\n            }\\n            return false;\\n        }\\n        \\n        // Check if banner was dismissed\\n        function wasBannerDismissed() {\\n            return localStorage.getItem(\'pwa-banner-dismissed\') === \'true\';\\n        }\\n        \\n        // Check if on GitHub Pages App (kh√¥ng hi·ªÉn th·ªã banner ·ªü ƒë√≥)\\n        function isOnAppPage() {\\n            const currentHost = window.location.hostname;\\n            return currentHost === \'nguenvanky.github.io\' && window.location.pathname.startsWith(\'/App/\');\\n        }\\n        \\n        // Show PWA install banner\\n        function showPWAInstallBanner() {\\n            if (!pwaBanner) {\\n                pwaBanner = document.getElementById(\'pwa-install-banner\');\\n            }\\n            \\n            // Kh√¥ng hi·ªÉn th·ªã banner n·∫øu ƒëang ·ªü trang App\\n            if (isOnAppPage()) {\\n                console.log(\'On GitHub Pages App page, cannot show banner\');\\n                alert(\'B·∫°n ƒëang ·ªü trang c√†i ƒë·∫∑t ·ª©ng d·ª•ng. Vui l√≤ng l√†m theo h∆∞·ªõng d·∫´n tr√™n trang n√†y ƒë·ªÉ c√†i ƒë·∫∑t.\');\\n                return;\\n            }\\n            \\n            if (isPWAInstalled() || wasBannerDismissed()) {\\n                return;\\n            }\\n            \\n            if (pwaBanner) {\\n                console.log(\'Force showing PWA banner\');\\n                pwaBanner.style.display = \'block\';\\n            }\\n        }\\n        \\n        // Install PWA - Android redirect to GitHub Pages, iPhone show instructions\\n        function installPWA() {\\n            console.log(\'installPWA called\');\\n            \\n            // Hide banner v√† dismiss\\n            if (pwaBanner) {\\n                pwaBanner.style.display = \'none\';\\n            }\\n            localStorage.setItem(\'pwa-banner-dismissed\', \'true\');\\n            \\n            // Detect platform\\n            const isAndroid = /Android/.test(navigator.userAgent);\\n            const isIOS = /iPhone|iPad|iPod/.test(navigator.userAgent);\\n            \\n            if (isAndroid) {\\n                // Android: Redirect to GitHub Pages App ƒë·ªÉ c√†i ƒë·∫∑t\\n                console.log(\'Android detected - redirecting to GitHub Pages App\');\\n                window.location.href = \'https://nguenvanky.github.io/App/\';\\n            } else if (isIOS) {\\n                // iOS: Hi·ªÉn th·ªã h∆∞·ªõng d·∫´n c√†i ƒë·∫∑t tr·ª±c ti·∫øp t·ª´ trang hi·ªán t·∫°i (kh√¥ng redirect)\\n                console.log(\'iOS detected - showing manual instructions for current page\');\\n                const instructions = \\n                    \'üì± H∆∞·ªõng d·∫´n c√†i ƒë·∫∑t tr√™n iPhone/iPad:\\n\\n\' +\\n                    \'1. Nh·∫•n n√∫t Share (m≈©i t√™n l√™n ‚¨ÜÔ∏è) ·ªü thanh ƒë·ªãa ch·ªâ Safari\\n\' +\\n                    \'2. Cu·ªôn xu·ªëng v√† ch·ªçn \"Th√™m v√†o M√†n h√¨nh ch√≠nh\" ho·∫∑c \"Add to Home Screen\"\\n\' +\\n                    \'3. Nh·∫•n \"Th√™m\" ho·∫∑c \"Add\" ·ªü g√≥c ph·∫£i tr√™n\\n\' +\\n                    \'4. ·ª®ng d·ª•ng s·∫Ω xu·∫•t hi·ªán tr√™n m√†n h√¨nh ch√≠nh c·ªßa b·∫°n\\n\\n\' +\\n                    \'üí° ·ª®ng d·ª•ng s·∫Ω l∆∞u tr·ª±c ti·∫øp trang Otto Control n√†y, kh√¥ng c·∫ßn qua GitHub Pages.\';\\n                alert(instructions);\\n            } else {\\n                // Desktop ho·∫∑c browser kh√°c: Redirect ƒë·∫øn GitHub Pages App\\n                console.log(\'Desktop/Other browser detected - redirecting to GitHub Pages App\');\\n                window.location.href = \'https://nguenvanky.github.io/App/\';\\n            }\\n        }\\n        \\n        // Dismiss banner\\n        function dismissPWA() {\\n            if (pwaBanner) {\\n                pwaBanner.style.display = \'none\';\\n            }\\n            localStorage.setItem(\'pwa-banner-dismissed\', \'true\');\\n            console.log(\'PWA banner dismissed\');\\n        }\\n        \\n        // Listen for beforeinstallprompt event (Android/Chrome)\\n        window.addEventListener(\'beforeinstallprompt\', function(e) {\\n            console.log(\'beforeinstallprompt event fired - browser supports automatic install\');\\n            e.preventDefault();\\n            deferredPrompt = e;\\n            \\n            if (pwaInstallBtn) {\\n                pwaInstallBtn.textContent = \'C√†i ƒë·∫∑t ngay\';\\n            }\\n            \\n            showPWAInstallBanner();\\n        });\\n        \\n        // Listen for appinstalled event\\n        window.addEventListener(\'appinstalled\', function(evt) {\\n            console.log(\'PWA app was installed successfully by browser\');\\n            if (pwaBanner) {\\n                pwaBanner.style.display = \'none\';\\n            }\\n            localStorage.setItem(\'pwa-banner-dismissed\', \'true\');\\n            // Hide PWA install button when PWA is installed (Otto page - use specific ID)\\n            const pwaInstallButton = document.getElementById(\'pwa-install-button-fixed-otto\') || document.querySelector(\'.pwa-install-fixed\');\\n            if (pwaInstallButton) {\\n                console.log(\'PWA installed - hiding install button\');\\n                pwaInstallButton.style.display = \'none\';\\n                pwaInstallButton.style.visibility = \'hidden\';\\n            }\\n        });\\n        \\n        // Initialize when DOM is ready\\n        if (document.readyState === \'loading\') {\\n            document.addEventListener(\'DOMContentLoaded\', initPWA);\\n        } else {\\n            // DOM already loaded\\n            initPWA();\\n        }\\n        \\n        // Hide PWA install button immediately if on GitHub Pages App page or PWA installed\\n        if (typeof hidePWAInstallButton === \'function\') {\\n            hidePWAInstallButton();\\n        } else {\\n            // Fallback if function not loaded yet (Otto page - use specific ID)\\n            setTimeout(function() {\\n                const pwaInstallButton = document.getElementById(\'pwa-install-button-fixed-otto\') || document.querySelector(\'.pwa-install-fixed\');\\n                if (pwaInstallButton) {\\n                    const currentHost = window.location.hostname;\\n                    const isOnApp = currentHost === \'nguenvanky.github.io\' && window.location.pathname.startsWith(\'/App/\');\\n                    const isInstalled = window.matchMedia(\'(display-mode: standalone)\').matches ||\\n                                       window.navigator.standalone === true ||\\n                                       (document.referrer && document.referrer.includes(\'android-app://\'));\\n                    if (isOnApp || isInstalled) {\\n                        console.log(\'Hiding PWA install button - on App page or PWA installed\');\\n                        pwaInstallButton.style.display = \'none\';\\n                        pwaInstallButton.style.visibility = \'hidden\';\\n                    }\\n                }\\n            }, 100);\\n        }\\n        \\n        // Also try to show banner even if beforeinstallprompt doesn\'t fire\\n        setTimeout(function() {\\n            if (!isPWAInstalled() && !wasBannerDismissed()) {\\n                console.log(\'Fallback: showing banner after 2 seconds\');\\n                showPWAInstallBanner();\\n            } else {\\n                console.log(\'Banner not shown - installed:\', isPWAInstalled(), \'dismissed:\', wasBannerDismissed());\\n            }\\n            // Check again to hide button after timeout\\n            if (typeof hidePWAInstallButton === \'function\') {\\n                hidePWAInstallButton();\\n            } else {\\n                const pwaInstallButton = document.querySelector(\'.pwa-install-fixed\');\\n                if (pwaInstallButton) {\\n                    const currentHost = window.location.hostname;\\n                    const isOnApp = currentHost === \'nguenvanky.github.io\' && window.location.pathname.startsWith(\'/App/\');\\n                    const isInstalled = window.matchMedia(\'(display-mode: standalone)\').matches ||\\n                                       window.navigator.standalone === true ||\\n                                       document.referrer.includes(\'android-app://\');\\n                    if (isOnApp || isInstalled) {\\n                        console.log(\'Hiding PWA install button - on App page or PWA installed\');\\n                        pwaInstallButton.style.display = \'none\';\\n                    }\\n                }\\n            }\\n        }, 2000);\\n        \\n        // Debug: Log PWA status\\n        console.log(\'PWA Status - Installed:\', isPWAInstalled(), \'Dismissed:\', wasBannerDismissed());\\n        </script>\\n    </noscript>\\n    \\n    </div>\\n    \\n    <!-- PWA Install Banner -->\\n    <div id=\"pwa-install-banner\" style=\"display: none; position: fixed; bottom: 0; left: 0; right: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px 20px; box-shadow: 0 -4px 20px rgba(0,0,0,0.3); z-index: 10000; animation: slideUp 0.3s ease-out;\">\\n        <div style=\"max-width: 1200px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 10px;\">\\n            <div style=\"flex: 1; min-width: 200px;\">\\n                <div style=\"font-weight: bold; font-size: 16px; margin-bottom: 5px;\">üì± C√†i ƒë·∫∑t ·ª©ng d·ª•ng</div>\\n                <div style=\"font-size: 13px; opacity: 0.9;\">C√†i ƒë·∫∑t ƒë·ªÉ truy c·∫≠p nhanh h∆°n v√† s·ª≠ d·ª•ng offline</div>\\n            </div>\\n            <div style=\"display: flex; gap: 10px; flex-wrap: wrap;\">\\n                <button id=\"pwa-install-btn\" onclick=\"installPWA()\" style=\"background: white; color: #667eea; border: none; padding: 10px 20px; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 14px; transition: all 0.3s; box-shadow: 0 2px 8px rgba(0,0,0,0.2);\" onmouseover=\"this.style.transform=\'translateY(-2px)\'; this.style.boxShadow=\'0 4px 12px rgba(0,0,0,0.3)\';\" onmouseout=\"this.style.transform=\'translateY(0)\'; this.style.boxShadow=\'0 2px 8px rgba(0,0,0,0.2)\';\">\\n                    C√†i ƒë·∫∑t ngay\\n                </button>\\n                <button onclick=\"dismissPWA()\" style=\"background: transparent; color: white; border: 2px solid white; padding: 10px 20px; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 14px; transition: all 0.3s;\" onmouseover=\"this.style.background=\'rgba(255,255,255,0.2)\';\" onmouseout=\"this.style.background=\'transparent\';\">\\n                    ƒê√≥ng\\n                </button>\\n            </div>\\n        </div>\\n    </div>\\n</body>\\n</html>\\n";
    
    // Inject HTML into DOM
    function injectHTML() {
        try {
            // Replace current document
            document.open();
            document.write(HTML_CONTENT);
            document.close();
            
            console.log('[JS Injector] Successfully injected Otto HTML');
        } catch (error) {
            console.error('[JS Injector] Failed to inject HTML:', error);
            // Fallback: try to load from ESP32
            const ESP32_IP = window.location.hostname;
            const ESP32_PORT = window.location.port || '80';
            const ESP32_BASE = `http://${ESP32_IP}:${ESP32_PORT}`;
            
            let fallbackUrl;
            const path = window.location.pathname;
            if (path.includes('/otto') || path.includes('/control')) {
                fallbackUrl = `${ESP32_BASE}/otto-fallback`;
            } else if (path.includes('/servo') || path.includes('/servo-calibration')) {
                fallbackUrl = `${ESP32_BASE}/servo-fallback`;
            } else {
                fallbackUrl = `${ESP32_BASE}/settings-fallback`;
            }
            
            console.log('[JS Injector] Loading fallback from:', fallbackUrl);
            window.location.href = fallbackUrl;
        }
    }
    
    // Inject immediately if DOM is ready, otherwise wait
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', injectHTML);
    } else {
        injectHTML();
    }
})();
