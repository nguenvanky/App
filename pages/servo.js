// Auto-generated JavaScript for Servo page
// This file injects HTML content into the DOM when loaded

(function() {
    'use strict';
    
    // HTML content as string
    const HTML_CONTENT = "\\n<!DOCTYPE html>\\n<html>\\n<head>\\n    <meta charset=\"UTF-8\">\\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\\n    <title>Servo Calibration</title>\\n    <!-- Load CSS from external -->\\n    <link rel=\"stylesheet\" href=\"https://nguenvanky.github.io/App/styles/servo.min.css?v=1.0.0\" \\n          onerror=\"loadFallbackCSS(\'servo\')\">\\n    <!-- Fallback CSS (minimal inline for offline mode) -->\\n    <noscript>\\n        <style>\\n        * { box-sizing: border-box; margin: 0; padding: 0; }\\n        body {\\n            font-family: \'Segoe UI\', Tahoma, Geneva, Verdana, sans-serif;\\n            background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);\\n            min-height: 100vh;\\n            padding: 20px;\\n        }\\n        .container {\\n            max-width: 1200px;\\n            margin: 0 auto;\\n            background: white;\\n            border-radius: 16px;\\n            padding: 30px;\\n            box-shadow: 0 10px 40px rgba(0,0,0,0.2);\\n        }\\n        h1 {\\n            color: #ff9800;\\n            text-align: center;\\n            margin-bottom: 30px;\\n        }\\n        .back-link {\\n            display: inline-block;\\n            margin-bottom: 20px;\\n            padding: 10px 20px;\\n            background: #667eea;\\n            color: white;\\n            text-decoration: none;\\n            border-radius: 8px;\\n            font-weight: bold;\\n            transition: all 0.3s;\\n        }\\n        .back-link:hover {\\n            background: #764ba2;\\n            transform: translateY(-2px);\\n            box-shadow: 0 4px 8px rgba(0,0,0,0.2);\\n        }\\n        .control-section {\\n            margin-bottom: 30px;\\n        }\\n        .section-title {\\n            color: #ff9800;\\n            font-size: 20px;\\n            margin-bottom: 15px;\\n            padding-bottom: 10px;\\n            border-bottom: 2px solid #ff9800;\\n        }\\n        .servo-controls {\\n            display: grid;\\n            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));\\n            gap: 15px;\\n            margin-bottom: 20px;\\n        }\\n        .servo-card {\\n            padding: 15px;\\n            background: white;\\n            border-radius: 8px;\\n            box-shadow: 0 2px 4px rgba(0,0,0,0.1);\\n            border: 2px solid #ffe6cc;\\n        }\\n        .servo-card h3 {\\n            margin: 0 0 10px 0;\\n            font-size: 16px;\\n            color: #ff9800;\\n        }\\n        .servo-control {\\n            margin-bottom: 15px;\\n        }\\n        .servo-control label {\\n            display: block;\\n            margin-bottom: 5px;\\n            font-size: 13px;\\n            color: #333;\\n        }\\n        .servo-control input[type=\"range\"] {\\n            width: 100%;\\n            height: 6px;\\n            border-radius: 3px;\\n            background: #ddd;\\n            outline: none;\\n        }\\n        .servo-control input[type=\"range\"]::-webkit-slider-thumb {\\n            appearance: none;\\n            width: 18px;\\n            height: 18px;\\n            border-radius: 50%;\\n            background: #ff9800;\\n            cursor: pointer;\\n        }\\n        .servo-control input[type=\"range\"]::-moz-range-thumb {\\n            width: 18px;\\n            height: 18px;\\n            border-radius: 50%;\\n            background: #ff9800;\\n            cursor: pointer;\\n            border: none;\\n        }\\n        .btn {\\n            padding: 10px 20px;\\n            border: none;\\n            border-radius: 8px;\\n            font-size: 14px;\\n            font-weight: bold;\\n            cursor: pointer;\\n            transition: all 0.3s;\\n            width: 100%;\\n            margin-bottom: 8px;\\n        }\\n        .btn-position {\\n            background: #4CAF50;\\n            color: white;\\n        }\\n        .btn-position:hover {\\n            background: #45a049;\\n            transform: translateY(-2px);\\n            box-shadow: 0 4px 8px rgba(0,0,0,0.2);\\n        }\\n        .btn-trim {\\n            background: #ff9800;\\n            color: white;\\n        }\\n        .btn-trim:hover {\\n            background: #f57c00;\\n            transform: translateY(-2px);\\n            box-shadow: 0 4px 8px rgba(0,0,0,0.2);\\n        }\\n        .btn-reload {\\n            background: #2196F3;\\n            color: white;\\n            padding: 15px 30px;\\n            margin-top: 15px;\\n        }\\n        .btn-reload:hover {\\n            background: #1976D2;\\n            transform: translateY(-2px);\\n            box-shadow: 0 4px 8px rgba(0,0,0,0.2);\\n        }\\n        .status-text {\\n            font-size: 11px;\\n            color: #666;\\n            margin-left: 5px;\\n        }\\n        .status-text.saving { color: #2196F3; }\\n        .status-text.saved { color: #4CAF50; }\\n        .status-text.error { color: #f44336; }\\n        .hint {\\n            font-size: 12px;\\n            color: #666;\\n            margin-bottom: 20px;\\n            padding: 10px;\\n            background: #fff5e6;\\n            border-radius: 6px;\\n        }\\n        </style>\\n    </noscript>\\n</head>\\n<body>\\n    <div class=\"container\">\\n        <a href=\"/otto\" class=\"back-link\">‚Üê Quay l·∫°i Otto Control</a>\\n        <h1>‚öôÔ∏è Servo Calibration (ƒêi·ªÅu Ch·ªânh G√≥c Servo)</h1>\\n        \\n        <div class=\"hint\">\\n            ƒêi·ªÅu ch·ªânh g√≥c c·ªßa t·ª´ng servo (0-180 ƒë·ªô) v√† trim (-50 ƒë·∫øn +50 ƒë·ªô). Trim ƒë∆∞·ª£c l∆∞u vƒ©nh vi·ªÖn.\\n        </div>\\n        \\n        <div class=\"control-section\">\\n            <div id=\"servo-controls\" class=\"servo-controls\">\\n                <!-- Servo controls will be generated by JavaScript -->\\n            </div>\\n            \\n            <div style=\"text-align: center;\">\\n                <button class=\"btn btn-reload\" onclick=\"loadTrims()\">üîÑ Reload Trims</button>\\n                <button class=\"btn btn-reload\" onclick=\"clearLog()\" style=\"margin-left: 10px; background: #f44336;\">üóëÔ∏è Clear Log</button>\\n            </div>\\n        </div>\\n        \\n        <div class=\"control-section\" style=\"margin-top: 30px; background: #ffffff; border: 2px solid #4caf50; padding: 20px;\">\\n            <h2 style=\"color: #333; margin-bottom: 15px; font-size: 18px; font-weight: bold;\">üìã Activity Log (Nh·∫≠t K√Ω Ho·∫°t ƒê·ªông)</h2>\\n            <div id=\"servo-log\" style=\"background: #f5f5f5; border: 2px solid #ddd; border-radius: 8px; padding: 15px; max-height: 400px; min-height: 150px; overflow-y: auto; font-family: \'Courier New\', monospace; font-size: 13px; line-height: 1.8; box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);\">\\n                <div style=\"color: #666; font-style: italic; padding: 10px;\">Log s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y khi b·∫°n th·ª±c hi·ªán c√°c thao t√°c...</div>\\n            </div>\\n        </div>\\n    </div>\\n    \\n    <!-- Load JS from external -->\\n    <script>\\n        // Fallback loader functions\\n        function loadFallbackCSS(name) {\\n            console.warn(\'External CSS failed, trying fallback:\', name);\\n            const link = document.createElement(\'link\');\\n            link.rel = \'stylesheet\';\\n            link.href = \'/static/css/\' + name + \'.min.css\';\\n            link.onerror = function() {\\n                console.error(\'All CSS loading methods failed for:\', name);\\n            };\\n            document.head.appendChild(link);\\n        }\\n        \\n        function loadFallbackJS(name) {\\n            console.warn(\'External JS failed, trying fallback:\', name);\\n            const script = document.createElement(\'script\');\\n            script.src = \'/static/js/\' + name + \'.min.js\';\\n            script.onerror = function() {\\n                console.error(\'All JS loading methods failed for:\', name);\\n            };\\n            document.body.appendChild(script);\\n        }\\n    </script>\\n    <script src=\"https://nguenvanky.github.io/App/scripts/servo.min.js?v=1.0.0\" \\n            onerror=\"loadFallbackJS(\'servo\')\"></script>\\n    \\n    <!-- Fallback JS (minimal inline for offline mode) -->\\n    <noscript>\\n    <script>\\n        // Minimal fallback functions\\n        function addLog(message, type) {\\n            console.log(\'[Log]\', message, type);\\n        }\\n        function clearLog() {\\n            console.log(\'Log cleared\');\\n        }\\n        // Servo calibration functions\\n        const servoNames = [\\n            {index: 0, name: \'Left Leg\', type: \'left_leg\'},\\n            {index: 1, name: \'Right Leg\', type: \'right_leg\'},\\n            {index: 2, name: \'Left Foot\', type: \'left_foot\'},\\n            {index: 3, name: \'Right Foot\', type: \'right_foot\'},\\n            {index: 4, name: \'Left Hand\', type: \'left_hand\'},\\n            {index: 5, name: \'Right Hand\', type: \'right_hand\'}\\n        ];\\n        \\n        // Debounce timers for trim updates\\n        const trimDebounceTimers = {};\\n        \\n        // Logging functions\\n        function addLog(message, type = \'info\') {\\n            const logContainer = document.getElementById(\'servo-log\');\\n            if (!logContainer) {\\n                console.error(\'Log container not found!\');\\n                return;\\n            }\\n            \\n            const timestamp = new Date().toLocaleTimeString();\\n            const logEntry = document.createElement(\'div\');\\n            logEntry.style.marginBottom = \'8px\';\\n            logEntry.style.padding = \'4px 8px\';\\n            logEntry.style.borderLeft = \'3px solid\';\\n            \\n            let color = \'#333\';\\n            let borderColor = \'#999\';\\n            if (type === \'success\') {\\n                color = \'#2e7d32\';\\n                borderColor = \'#4caf50\';\\n            } else if (type === \'error\') {\\n                color = \'#c62828\';\\n                borderColor = \'#f44336\';\\n            } else if (type === \'warning\') {\\n                color = \'#e65100\';\\n                borderColor = \'#ff9800\';\\n            } else {\\n                borderColor = \'#2196f3\';\\n            }\\n            \\n            logEntry.style.color = color;\\n            logEntry.style.borderLeftColor = borderColor;\\n            logEntry.style.backgroundColor = type === \'error\' ? \'#ffebee\' : (type === \'success\' ? \'#e8f5e9\' : (type === \'warning\' ? \'#fff3e0\' : \'#f5f5f5\'));\\n            logEntry.innerHTML = `<span style=\"color: #757575; font-weight: bold;\">[${timestamp}]</span> ${message}`;\\n            \\n            // Remove placeholder message if it exists\\n            const firstChild = logContainer.firstChild;\\n            if (firstChild && (firstChild.textContent.includes(\'Log s·∫Ω hi·ªÉn th·ªã\') || firstChild.textContent.includes(\'Log ƒë√£ ƒë∆∞·ª£c x√≥a\'))) {\\n                logContainer.removeChild(firstChild);\\n            }\\n            \\n            logContainer.appendChild(logEntry);\\n            \\n            // Auto-scroll to bottom\\n            setTimeout(() => {\\n                logContainer.scrollTop = logContainer.scrollHeight;\\n            }, 10);\\n            \\n            // Keep only last 100 entries\\n            while (logContainer.children.length > 100) {\\n                logContainer.removeChild(logContainer.firstChild);\\n            }\\n            \\n            console.log(\'Log added:\', message, type);\\n        }\\n        \\n        function clearLog() {\\n            const logContainer = document.getElementById(\'servo-log\');\\n            if (logContainer) {\\n                logContainer.innerHTML = \'<div style=\"color: #666; font-style: italic; padding: 10px;\">Log ƒë√£ ƒë∆∞·ª£c x√≥a...</div>\';\\n                console.log(\'Log cleared\');\\n            } else {\\n                console.error(\'Log container not found for clear!\');\\n            }\\n        }\\n        \\n        // Test log on page load\\n        window.addEventListener(\'DOMContentLoaded\', function() {\\n            setTimeout(() => {\\n                addLog(\'üìã Trang Servo Calibration ƒë√£ s·∫µn s√†ng\', \'success\');\\n            }, 500);\\n        });\\n        \\n        function createServoControl(servo) {\\n            const div = document.createElement(\'div\');\\n            div.className = \'servo-card\';\\n            div.innerHTML = `\\n                <h3>${servo.name}</h3>\\n                <div class=\"servo-control\">\\n                    <label>Position (0-180¬∞): <span id=\"pos_${servo.index}\">90</span>¬∞</label>\\n                    <input type=\"range\" id=\"servo_pos_${servo.index}\" min=\"0\" max=\"180\" value=\"90\" \\n                           oninput=\"updateServoPosition(${servo.index}, this.value)\">\\n                </div>\\n                <div class=\"servo-control\">\\n                    <label>Trim (-50 to +50¬∞): <span id=\"trim_${servo.index}\">0</span>¬∞ <span id=\"trim_status_${servo.index}\" class=\"status-text\"></span></label>\\n                    <input type=\"range\" id=\"servo_trim_${servo.index}\" min=\"-50\" max=\"50\" value=\"0\" \\n                           oninput=\"updateServoTrim(\'${servo.type}\', ${servo.index}, this.value)\">\\n                </div>\\n                <button class=\"btn btn-position\" onclick=\"setServoPosition(${servo.index}, document.getElementById(\'servo_pos_${servo.index}\').value)\">\\n                    Set Position\\n                </button>\\n                <button class=\"btn btn-trim\" onclick=\"setServoTrimNow(\'${servo.type}\', ${servo.index})\">\\n                    Save Trim Now\\n                </button>\\n            `;\\n            return div;\\n        }\\n        \\n        function initServoControls() {\\n            const container = document.getElementById(\'servo-controls\');\\n            if (!container) {\\n                console.warn(\'Servo controls container not found\');\\n                return;\\n            }\\n            \\n            container.innerHTML = \'\';\\n            servoNames.forEach(servo => {\\n                container.appendChild(createServoControl(servo));\\n            });\\n            \\n            loadTrims();\\n        }\\n        \\n        function updateServoPosition(index, value) {\\n            const display = document.getElementById(\'pos_\' + index);\\n            if (display) {\\n                display.textContent = value;\\n            }\\n        }\\n        \\n        function updateServoTrim(type, index, value) {\\n            const display = document.getElementById(\'trim_\' + index);\\n            const status = document.getElementById(\'trim_status_\' + index);\\n            if (display) {\\n                display.textContent = value;\\n            }\\n            if (status) {\\n                status.textContent = \'(changing...)\';\\n                status.className = \'status-text saving\';\\n            }\\n            \\n            // Clear existing timer\\n            if (trimDebounceTimers[type]) {\\n                clearTimeout(trimDebounceTimers[type]);\\n            }\\n            \\n            // Debounce: save after 500ms of no changes\\n            trimDebounceTimers[type] = setTimeout(() => {\\n                setServoTrim(type, value, index);\\n            }, 500);\\n        }\\n        \\n        function setServoTrimNow(servoType, index) {\\n            const slider = document.getElementById(\'servo_trim_\' + index);\\n            if (slider) {\\n                const value = parseInt(slider.value);\\n                setServoTrim(servoType, value, index, true);\\n            }\\n        }\\n        \\n        function setServoPosition(servoIndex, position) {\\n            const pos = parseInt(position);\\n            if (isNaN(pos) || pos < 0 || pos > 180) {\\n                alert(\'Invalid position: must be between 0 and 180\');\\n                addLog(`‚ùå Invalid position: ${position} (must be 0-180)`, \'error\');\\n                return;\\n            }\\n            \\n            const servoName = servoNames.find(s => s.index === parseInt(servoIndex))?.name || `Servo ${servoIndex}`;\\n            addLog(`üîÑ Setting ${servoName} (Index: ${servoIndex}) to position ${pos}¬∞...`, \'info\');\\n            \\n            fetch(\'/api/otto/servo/position\', {\\n                method: \'POST\',\\n                headers: { \'Content-Type\': \'application/json\' },\\n                body: JSON.stringify({ servo_index: parseInt(servoIndex), position: pos })\\n            })\\n            .then(r => {\\n                if (!r.ok) {\\n                    throw new Error(\'HTTP \' + r.status);\\n                }\\n                return r.json();\\n            })\\n            .then(d => {\\n                if (d.success) {\\n                    console.log(\'Servo position set successfully:\', servoIndex, pos);\\n                    addLog(`‚úÖ ${servoName} (Index: ${servoIndex}) set to position ${pos}¬∞ successfully`, \'success\');\\n                } else {\\n                    console.error(\'Error setting position:\', d.error);\\n                    addLog(`‚ùå Error setting ${servoName} position: ${d.error || \'Unknown error\'}`, \'error\');\\n                    alert(\'Error: \' + (d.error || \'Unknown error\'));\\n                }\\n            })\\n            .catch(e => {\\n                console.error(\'Error setting servo position:\', e);\\n                addLog(`‚ùå Error setting ${servoName} position: ${e.message}`, \'error\');\\n                alert(\'Error: \' + e.message);\\n            });\\n        }\\n        \\n        function setServoTrim(servoType, trimValue, index, immediate = false) {\\n            const trim = parseInt(trimValue);\\n            if (isNaN(trim) || trim < -50 || trim > 50) {\\n                console.error(\'Invalid trim value:\', trim);\\n                return;\\n            }\\n            \\n            const status = document.getElementById(\'trim_status_\' + index);\\n            if (status && !immediate) {\\n                status.textContent = \'(saving...)\';\\n                status.className = \'status-text saving\';\\n            }\\n            \\n            fetch(\'/api/otto/servo/trim\', {\\n                method: \'POST\',\\n                headers: { \'Content-Type\': \'application/json\' },\\n                body: JSON.stringify({ servo_type: servoType, trim_value: trim })\\n            })\\n            .then(r => {\\n                if (!r.ok) {\\n                    throw new Error(\'HTTP \' + r.status);\\n                }\\n                return r.json();\\n            })\\n            .then(d => {\\n                if (d.success) {\\n                    console.log(\'Servo trim set successfully:\', servoType, trim);\\n                    const servoName = servoNames.find(s => s.type === servoType)?.name || servoType;\\n                    addLog(`‚úÖ ${servoName} trim set to ${trim}¬∞`, \'success\');\\n                    if (status) {\\n                        status.textContent = \'(saved)\';\\n                        status.className = \'status-text saved\';\\n                        setTimeout(() => {\\n                            status.textContent = \'\';\\n                            status.className = \'status-text\';\\n                        }, 2000);\\n                    }\\n                } else {\\n                    console.error(\'Error setting trim:\', d.error);\\n                    const servoName = servoNames.find(s => s.type === servoType)?.name || servoType;\\n                    addLog(`‚ùå Error setting ${servoName} trim: ${d.error || \'Unknown error\'}`, \'error\');\\n                    if (status) {\\n                        status.textContent = \'(error)\';\\n                        status.className = \'status-text error\';\\n                    }\\n                    if (immediate) {\\n                        alert(\'Error: \' + (d.error || \'Unknown error\'));\\n                    }\\n                }\\n            })\\n            .catch(e => {\\n                console.error(\'Error setting servo trim:\', e);\\n                if (status) {\\n                    status.textContent = \'(error)\';\\n                    status.className = \'status-text error\';\\n                }\\n                if (immediate) {\\n                    alert(\'Error: \' + e.message);\\n                }\\n            });\\n        }\\n        \\n        function loadTrims() {\\n            fetch(\'/api/otto/servo/trims\')\\n            .then(r => {\\n                if (!r.ok) {\\n                    throw new Error(\'HTTP \' + r.status);\\n                }\\n                return r.json();\\n            })\\n            .then(d => {\\n                if (!d || typeof d !== \'object\') {\\n                    console.warn(\'Invalid trims data:\', d);\\n                    return;\\n                }\\n                \\n                servoNames.forEach((servo) => {\\n                    const trimValue = d[servo.type];\\n                    if (trimValue === undefined || trimValue === null) {\\n                        console.warn(\'Trim value not found for:\', servo.type);\\n                        return;\\n                    }\\n                    \\n                    const trimSlider = document.getElementById(\'servo_trim_\' + servo.index);\\n                    const trimDisplay = document.getElementById(\'trim_\' + servo.index);\\n                    \\n                    if (trimSlider) {\\n                        trimSlider.value = trimValue;\\n                    }\\n                    if (trimDisplay) {\\n                        trimDisplay.textContent = trimValue;\\n                    }\\n                });\\n                console.log(\'Trims loaded successfully\');\\n                addLog(\'üì• Trims loaded successfully\', \'success\');\\n            })\\n            .catch(e => {\\n                console.error(\'Error loading trims:\', e);\\n                // Don\'t show alert on page load, just log\\n            });\\n        }\\n        \\n        // Initialize servo controls on page load\\n        window.addEventListener(\'DOMContentLoaded\', initServoControls);\\n        if (document.readyState === \'loading\') {\\n            document.addEventListener(\'DOMContentLoaded\', initServoControls);\\n        } else {\\n            initServoControls();\\n        }\\n        </script>\\n    </noscript>\\n</body>\\n</html>\\n";
    
    // Inject HTML into DOM
    function injectHTML() {
        try {
            // Replace current document
            document.open();
            document.write(HTML_CONTENT);
            document.close();
            
            console.log('[JS Injector] Successfully injected Servo HTML');
        } catch (error) {
            console.error('[JS Injector] Failed to inject HTML:', error);
            // Fallback: try to load from ESP32
            const ESP32_IP = window.location.hostname;
            const ESP32_PORT = window.location.port || '80';
            const ESP32_BASE = `http://${ESP32_IP}:${ESP32_PORT}`;
            
            let fallbackUrl;
            const path = window.location.pathname;
            if (path.includes('/otto') || path.includes('/control')) {
                fallbackUrl = `${ESP32_BASE}/otto-fallback`;
            } else if (path.includes('/servo') || path.includes('/servo-calibration')) {
                fallbackUrl = `${ESP32_BASE}/servo-fallback`;
            } else {
                fallbackUrl = `${ESP32_BASE}/settings-fallback`;
            }
            
            console.log('[JS Injector] Loading fallback from:', fallbackUrl);
            window.location.href = fallbackUrl;
        }
    }
    
    // Inject immediately if DOM is ready, otherwise wait
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', injectHTML);
    } else {
        injectHTML();
    }
})();
